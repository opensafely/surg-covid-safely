colnames(PNV_OS_NC_counts) <- colnames(COVIDSurg_counts)
## ## # Pandemic with vaccines, OpenSAFELY data, no-cancer patients.
PWV_OS_NC_counts <- OS_NC_counts %>%
dplyr::filter(era == "Pandemic with vaccine" &
preOperative_infection_status !=
"Error: Test result after surgery. Check study_definition.") %>%
dplyr::arrange(preOperative_infection_status) %>% select(n) %>% t() %>% data.frame()
PWV_OS_NC_counts <- cbind(sum(PWV_OS_NC_counts), PWV_OS_NC_counts)
colnames(PWV_OS_NC_counts) <- colnames(COVIDSurg_counts)
## #  OpenSAFELY data, cancer patients.
OS_C_counts <-
myData_OS_C %>%
dplyr::group_by(era,
preOperative_infection_status) %>%
dplyr::summarise(n = n())
OS_C_counts <-
expand.grid(
era =
c("Error: No surgery", "Pre-pandemic", "Pandemic no vaccine", "Pandemic with vaccine"),
"preOperative_infection_status" =
c("Error: Test result after surgery. Check study_definition.",
"No record of pre-operative SARS-CoV-2 infection",
"0-2 weeks record of pre-operative SARS-CoV-2 infection",
"3-4 weeks record of pre-operative SARS-CoV-2 infection",
"5-6 weeks record of pre-operative SARS-CoV-2 infection",
">=7 weeks record of pre-operative SARS-CoV-2 infection")) %>%
dplyr::full_join(OS_C_counts) %>%
dplyr::arrange(era) %>%
tidyr::replace_na(list("n" = 0))
## ## # Pre-pandemic, OpenSAFELY data, no-cancer patients.
PP_OS_C_counts <- OS_C_counts %>%
dplyr::filter(era == "Pre-pandemic" &
preOperative_infection_status !=
"Error: Test result after surgery. Check study_definition.") %>%
dplyr::arrange(preOperative_infection_status) %>% select(n) %>% t() %>% data.frame()
PP_OS_C_counts <- cbind(sum(PP_OS_C_counts), PP_OS_C_counts)
colnames(PP_OS_C_counts) <- colnames(COVIDSurg_counts)
## ## # Pandemic no vaccines, OpenSAFELY data, no-cancer patients.
PNV_OS_C_counts <- OS_C_counts %>%
dplyr::filter(era == "Pandemic no vaccine" &
preOperative_infection_status !=
"Error: Test result after surgery. Check study_definition.") %>%
dplyr::arrange(preOperative_infection_status) %>% select(n) %>% t() %>% data.frame()
PNV_OS_C_counts <- cbind(sum(PNV_OS_C_counts), PNV_OS_C_counts)
colnames(PNV_OS_C_counts) <- colnames(COVIDSurg_counts)
## ## # Pandemic with vaccines, OpenSAFELY data, no-cancer patients.
PWV_OS_C_counts <- OS_C_counts %>%
dplyr::filter(era == "Pandemic with vaccine" &
preOperative_infection_status !=
"Error: Test result after surgery. Check study_definition.") %>%
dplyr::arrange(preOperative_infection_status) %>% select(n) %>% t() %>% data.frame()
PWV_OS_C_counts <- cbind(sum(PWV_OS_C_counts), PWV_OS_C_counts)
colnames(PWV_OS_C_counts) <- colnames(COVIDSurg_counts)
# ----
##################################################################
## Counts of 30-day post-operative mortality, across intervals. ##
## Non-cancer patients.                                         ##
##################################################################
# ----
# Count of patients in each of the categories for pre-operative infection
# status (stratified by surgery era; see above) also stratified by whether
# or not the patient died within 30 days of their surgery:
#   1. "Alive within 30-day post-operation"
#   2. "Dead within 30-day post-operation"
#
## # OpenSAFELY data, nom-cancer patients.
OS_NC_mortality <-
myData_OS_NC %>% dplyr::group_by(era, postOp_mortality_30day) %>%
dplyr::summarise(n_per_group = sum(ifelse(preOperative_infection_status!=
"Error: Test result after surgery. Check study_definition.",1,0)),
n_infection_none = sum(ifelse(preOperative_infection_status==
"No record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_0to2wk = sum(ifelse(preOperative_infection_status==
"0-2 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_3to4wk = sum(ifelse(preOperative_infection_status==
"3-4 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_5to6wk = sum(ifelse(preOperative_infection_status==
"5-6 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_7wk = sum(ifelse(preOperative_infection_status==
">=7 weeks record of pre-operative SARS-CoV-2 infection",1,0))
)
OS_NC_mortality <-
expand.grid(
era =
c("Error: No surgery", "Pre-pandemic", "Pandemic no vaccine", "Pandemic with vaccine"),
postOp_mortality_30day =
c("Alive within 30-day post-operation",
"Dead within 30-day post-operation",
"Error: Surgery after death",
"No death recorded",
"No surgery recorded",
"Missing")) %>%
dplyr::full_join(OS_NC_mortality) %>%
dplyr::arrange(era) %>%
tidyr::replace_na(list("n_per_group" = 0,
"n_infection_none" = 0,
"n_infection_0to2wk" = 0,
"n_infection_3to4wk" = 0,
"n_infection_5to6wk" = 0,
"n_infection_7wk" = 0))
## ## # Pre-pandemic, OpenSAFELY data, no-cancer patients.
PP_OS_NC_mortality <- OS_NC_mortality %>%
dplyr::filter(era == "Pre-pandemic" &
postOp_mortality_30day=="Alive within 30-day post-operation") %>%
select(-c(era, postOp_mortality_30day, n_per_group)) %>% dplyr::ungroup()
## ## ## # Counts of 30-day post-operative mortality, across intervals.
PP_OS_NC_mortality_intervals <- data.frame(
n_infection_none = 0,
pct_no_infection = 0,
n_infection_0to2wk = 0,
pct_infection_0to2wk = 0,
n_infection_3to4wk = 0,
pct_infection_3to4wk = 0,
n_infection_5to6wk = 0,
pct_infection_5to6wk = 0,
n_infection_7wk = 0,
pct_infection_7wk = 0
)
PP_OS_NC_mortality_intervals[seq(1,10,2)] <- PP_OS_NC_mortality
## ## ## # Percentages of 30-day post-operative mortality, across intervals.
PP_OS_NC_mortality_intervals[seq(2,10,2)] <-
(PP_OS_NC_mortality_intervals[seq(1,10,2)] /
PP_OS_NC_counts[2:ncol(PP_OS_NC_counts)]) * 100
## ## # Pandemic no vaccines, OpenSAFELY data, no-cancer patients.
PNV_OS_NC_mortality <- OS_NC_mortality %>%
dplyr::filter(era == "Pandemic no vaccine" &
postOp_mortality_30day=="Alive within 30-day post-operation") %>%
select(-c(era, postOp_mortality_30day, n_per_group)) %>% dplyr::ungroup()
## ## ## # Counts of 30-day post-operative mortality, across intervals.
PNV_OS_NC_mortality_intervals <- data.frame(
n_infection_none = 0,
pct_no_infection = 0,
n_infection_0to2wk = 0,
pct_infection_0to2wk = 0,
n_infection_3to4wk = 0,
pct_infection_3to4wk = 0,
n_infection_5to6wk = 0,
pct_infection_5to6wk = 0,
n_infection_7wk = 0,
pct_infection_7wk = 0
)
PNV_OS_NC_mortality_intervals[seq(1,10,2)] <- PNV_OS_NC_mortality
## ## ## # Percentages of 30-day post-operative mortality, across intervals.
PNV_OS_NC_mortality_intervals[seq(2,10,2)] <-
(PNV_OS_NC_mortality_intervals[seq(1,10,2)] /
PNV_OS_NC_counts[2:ncol(PNV_OS_NC_counts)]) * 100
## ## # Pandemic with vaccines, OpenSAFELY data, no-cancer patients.
PWV_OS_NC_mortality <- OS_NC_mortality %>%
dplyr::filter(era == "Pandemic with vaccine" &
postOp_mortality_30day=="Alive within 30-day post-operation") %>%
select(-c(era, postOp_mortality_30day, n_per_group)) %>% dplyr::ungroup()
## ## ## # Counts of 30-day post-operative mortality, across intervals.
PWV_OS_NC_mortality_intervals <- data.frame(
n_infection_none = 0,
pct_no_infection = 0,
n_infection_0to2wk = 0,
pct_infection_0to2wk = 0,
n_infection_3to4wk = 0,
pct_infection_3to4wk = 0,
n_infection_5to6wk = 0,
pct_infection_5to6wk = 0,
n_infection_7wk = 0,
pct_infection_7wk = 0
)
PWV_OS_NC_mortality_intervals[seq(1,10,2)] <- PWV_OS_NC_mortality
## ## ## # Percentages of 30-day post-operative mortality, across intervals.
PWV_OS_NC_mortality_intervals[seq(2,10,2)] <-
(PWV_OS_NC_mortality_intervals[seq(1,10,2)] /
PWV_OS_NC_counts[2:ncol(PWV_OS_NC_counts)]) * 100
# ----
##################################################################
## Counts of 30-day post-operative mortality, across intervals. ##
## Cancer patients.                                             ##
##################################################################
# ----
# Count of patients in each of the categories for pre-operative infection
# status (stratified by surgery era; see above) also stratified by whether
# or not the patient died within 30 days of their surgery:
#   1. "Alive within 30-day post-operation"
#   2. "Dead within 30-day post-operation"
#
## # OpenSAFELY data, cancer patients.
OS_C_mortality <-
myData_OS_C %>% dplyr::group_by(era, postOp_mortality_30day) %>%
dplyr::summarise(n_per_group = sum(ifelse(preOperative_infection_status!=
"Error: Test result after surgery. Check study_definition.",1,0)),
n_infection_none = sum(ifelse(preOperative_infection_status==
"No record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_0to2wk = sum(ifelse(preOperative_infection_status==
"0-2 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_3to4wk = sum(ifelse(preOperative_infection_status==
"3-4 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_5to6wk = sum(ifelse(preOperative_infection_status==
"5-6 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_7wk = sum(ifelse(preOperative_infection_status==
">=7 weeks record of pre-operative SARS-CoV-2 infection",1,0))
)
OS_C_mortality <-
expand.grid(
era =
c("Error: No surgery", "Pre-pandemic", "Pandemic no vaccine", "Pandemic with vaccine"),
postOp_mortality_30day =
c("Alive within 30-day post-operation",
"Dead within 30-day post-operation",
"Error: Surgery after death",
"No death recorded",
"No surgery recorded",
"Missing")) %>%
dplyr::full_join(OS_C_mortality) %>%
dplyr::arrange(era) %>%
tidyr::replace_na(list("n_per_group" = 0,
"n_infection_none" = 0,
"n_infection_0to2wk" = 0,
"n_infection_3to4wk" = 0,
"n_infection_5to6wk" = 0,
"n_infection_7wk" = 0))
## ## # Pre-pandemic, OpenSAFELY data, no-cancer patients.
PP_OS_C_mortality <- OS_C_mortality %>%
dplyr::filter(era == "Pre-pandemic" &
postOp_mortality_30day=="Alive within 30-day post-operation") %>%
select(-c(era, postOp_mortality_30day, n_per_group)) %>% dplyr::ungroup()
## ## ## # Counts of 30-day post-operative mortality, across intervals.
PP_OS_C_mortality_intervals <- data.frame(
n_infection_none = 0,
pct_no_infection = 0,
n_infection_0to2wk = 0,
pct_infection_0to2wk = 0,
n_infection_3to4wk = 0,
pct_infection_3to4wk = 0,
n_infection_5to6wk = 0,
pct_infection_5to6wk = 0,
n_infection_7wk = 0,
pct_infection_7wk = 0
)
PP_OS_C_mortality_intervals[seq(1,10,2)] <- PP_OS_C_mortality
## ## ## # Percentages of 30-day post-operative mortality, across intervals.
PP_OS_C_mortality_intervals[seq(2,10,2)] <-
(PP_OS_C_mortality_intervals[seq(1,10,2)] /
PP_OS_C_counts[2:ncol(PP_OS_C_counts)]) * 100
## ## # Pandemic no vaccines, OpenSAFELY data, no-cancer patients.
PNV_OS_C_mortality <- OS_C_mortality %>%
dplyr::filter(era == "Pandemic no vaccine" &
postOp_mortality_30day=="Alive within 30-day post-operation") %>%
select(-c(era, postOp_mortality_30day, n_per_group)) %>% dplyr::ungroup()
## ## ## # Counts of 30-day post-operative mortality, across intervals.
PNV_OS_C_mortality_intervals <- data.frame(
n_infection_none = 0,
pct_no_infection = 0,
n_infection_0to2wk = 0,
pct_infection_0to2wk = 0,
n_infection_3to4wk = 0,
pct_infection_3to4wk = 0,
n_infection_5to6wk = 0,
pct_infection_5to6wk = 0,
n_infection_7wk = 0,
pct_infection_7wk = 0
)
PNV_OS_C_mortality_intervals[seq(1,10,2)] <- PNV_OS_C_mortality
## ## ## # Percentages of 30-day post-operative mortality, across intervals.
PNV_OS_C_mortality_intervals[seq(2,10,2)] <-
(PNV_OS_C_mortality_intervals[seq(1,10,2)] /
PNV_OS_C_counts[2:ncol(PNV_OS_C_counts)]) * 100
## ## # Pandemic with vaccines, OpenSAFELY data, no-cancer patients.
PWV_OS_C_mortality <- OS_C_mortality %>%
dplyr::filter(era == "Pandemic with vaccine" &
postOp_mortality_30day=="Alive within 30-day post-operation") %>%
select(-c(era, postOp_mortality_30day, n_per_group)) %>% dplyr::ungroup()
## ## ## # Counts of 30-day post-operative mortality, across intervals.
PWV_OS_C_mortality_intervals <- data.frame(
n_infection_none = 0,
pct_no_infection = 0,
n_infection_0to2wk = 0,
pct_infection_0to2wk = 0,
n_infection_3to4wk = 0,
pct_infection_3to4wk = 0,
n_infection_5to6wk = 0,
pct_infection_5to6wk = 0,
n_infection_7wk = 0,
pct_infection_7wk = 0
)
PWV_OS_C_mortality_intervals[seq(1,10,2)] <- PWV_OS_C_mortality
## ## ## # Percentages of 30-day post-operative mortality, across intervals.
PWV_OS_C_mortality_intervals[seq(2,10,2)] <-
(PWV_OS_C_mortality_intervals[seq(1,10,2)] /
PWV_OS_C_counts[2:ncol(PWV_OS_C_counts)]) * 100
# ----
#############################
## Construct counts table. ##
#############################
# ----
table_counts <-
rbind(
rep(NA, 6), # Pre-pandemic, COVIDSurg.
PP_OS_NC_counts, # Pre-pandemic, OpenSAFELY data, no-cancer patients.
PP_OS_C_counts, # Pre-pandemic, OpenSAFELY data, cancer patients.
COVIDSurg_counts,
PNV_OS_NC_counts, # Pandemic no vaccines, OpenSAFELY data, no-cancer patients.
PNV_OS_C_counts, # Pandemic no vaccines, OpenSAFELY data, cancer patients.
rep(NA, 6), # Pandemic with vaccines, COVIDSurg.
PWV_OS_NC_counts, # Pandemic with vaccines, OpenSAFELY data, no-cancer patients.
PWV_OS_C_counts # Pandemic with vaccines, OpenSAFELY data, cancer patients.
) %>% data.frame()
rownames(table_counts) <-
c(
"PP_COVIDSurg",
"PP_OS_NC",
"PP_OS_C",
"PNV_COVIDSurg",
"PNV_OS_NC",
"PNV_OS_C",
"PWV_COVIDSurg",
"PWV_OS_NC",
"PWV_OS_C"
)
write.csv(
x = table_counts,
file = here::here("output",
"table_Count of patients in each cohort, in each era, across all intervals.csv")
)
# ----
#################################################
## Construct mortality-across-intervals table. ##
#################################################
# ----
table_mortality_intervals <-
rbind(
COVIDSurg_mortality_intervals,
PNV_OS_NC_mortality_intervals,
PNV_OS_C_mortality_intervals,
rep(NA, 10),
PWV_OS_NC_mortality_intervals,
PWV_OS_C_mortality_intervals
)
rownames(table_mortality_intervals) <-
c(
"PNV_COVIDSurg",
"PNV_OS_NC",
"PNV_OS_C",
"PWV_COVIDSurg",
"PWV_OS_NC",
"PWV_OS_C"
)
write.csv(
x = table_mortality_intervals,
file = here::here("output",
"table_30day post-op mortality, in each era, across all intervals.csv")
)
# ----
#######################################
## Construct mortality-totals table. ##
#######################################
# ----
table_mortality_totals <-
rbind(
COVIDSurg_mortality_totals,
era_OS_NC_values,
era_OS_C_values
)
rownames(table_mortality_totals) <-
c(
"COVIDSurg",
"OS_NC",
"OS_C"
)
write.csv(
x = table_mortality_totals,
file = here::here("output",
"table_30day post-op mortality for each cohort, in each era.csv")
)
# ----
#############################################################
## Counts of 30-day post-operative mortality, in each era. ##
## Non-cancer patients.                                    ##
#############################################################
# ----
COVIDSurg_mortality_intervals
#############################################################
## Counts of 30-day post-operative mortality, in each era. ##
## Non-cancer patients.                                    ##
#############################################################
# ----
COVIDSurg_mortality_intervals[seq(1,10,2)]
#############################################################
## Counts of 30-day post-operative mortality, in each era. ##
## Non-cancer patients.                                    ##
#############################################################
# ----
sum(COVIDSurg_mortality_intervals[seq(1,10,2)])
#############################################################
## Counts of 30-day post-operative mortality, in each era. ##
## Non-cancer patients.                                    ##
#############################################################
# ----
sum(PNV_OS_NC_mortality_intervals[seq(1,10,2)])
#############################################################
## Counts of 30-day post-operative mortality, in each era. ##
## Non-cancer patients.                                    ##
#############################################################
# ----
sum(PP_OS_NC_mortality_intervals[seq(1,10,2)])
sum(PWV_OS_NC_mortality_intervals[seq(1,10,2)])
#############################################################
## Counts of 30-day post-operative mortality, in each era. ##
## Non-cancer patients.                                    ##
#############################################################
# ----
OS_NC_mortality_totals <- data.frame(
n_PP = rep(0,3),
pct_PP = rep(0,3),
n_PNV = rep(0,3),
pct_PNV = rep(0,3),
n_PWV = rep(0,3),
pct_PWV = rep(0,3)
)
#############################################################
## Counts of 30-day post-operative mortality, in each era. ##
## Non-cancer patients.                                    ##
#############################################################
# ----
OS_NC_mortality_totals <- data.frame(
n_PP = sum(PP_OS_NC_mortality_intervals[seq(1,10,2)]),
pct_PP = 0,
n_PNV = sum(PNV_OS_NC_mortality_intervals[seq(1,10,2)]),
pct_PNV = 0,
n_PWV = sum(PWV_OS_NC_mortality_intervals[seq(1,10,2)]),
pct_PWV = 0
)
OS_NC_mortality_totals
View(OS_NC_counts)
OS_NC_mortality_totals[seq(2,10,2)] <-
(OS_NC_mortality_totals[seq(1,10,2)] / PP_OS_NC_counts$n_total) * 100
OS_NC_mortality_totals[seq(1,10,2)]
#############################################################
## Counts of 30-day post-operative mortality, in each era. ##
## Non-cancer patients.                                    ##
#############################################################
# ----
OS_NC_mortality_totals <- data.frame(
n_PP = sum(PP_OS_NC_mortality_intervals[seq(1,10,2)]),
pct_PP = 0,
n_PNV = sum(PNV_OS_NC_mortality_intervals[seq(1,10,2)]),
pct_PNV = 0,
n_PWV = sum(PWV_OS_NC_mortality_intervals[seq(1,10,2)]),
pct_PWV = 0
)
OS_NC_mortality_totals[seq(2,10,2)]
OS_NC_mortality_totals
OS_NC_mortality_totals[seq(2,6,2)] <-
(OS_NC_mortality_totals[seq(1,6,2)] / PP_OS_NC_counts$n_total) * 100
OS_NC_mortality_totals
OS_NC_mortality_totals[seq(2,6,2)] <-
(OS_NC_mortality_totals[seq(1,6,2)] /
c(PP_OS_NC_counts$n_total,
PNV_OS_NC_counts$n_total,
PWV_OS_NC_counts$n_total)
) * 100
OS_NC_mortality_totals
PNV_OS_NC_counts$n_total
# OpenSAFELY data, cancer patients.
OS_C_mortality_totals <- data.frame(
n_PP = sum(PP_OS_C_mortality_intervals[seq(1,10,2)]),
pct_PP = 0,
n_PNV = sum(PNV_OS_C_mortality_intervals[seq(1,10,2)]),
pct_PNV = 0,
n_PWV = sum(PWV_OS_C_mortality_intervals[seq(1,10,2)]),
pct_PWV = 0
)
OS_C_mortality_totals[seq(2,6,2)] <-
(OS_C_mortality_totals[seq(1,6,2)] /
c(PP_OS_C_counts$n_total,
PNV_OS_C_counts$n_total,
PWV_OS_C_counts$n_total)
) * 100
#######################################
## Construct mortality-totals table. ##
#######################################
# ----
table_mortality_totals <-
rbind(
COVIDSurg_mortality_totals,
OS_NC_mortality_totals,
OS_C_mortality_totals
)
rm(table_mortality_totals)
COVIDSurg_mortality_totals
OS_NC_mortality_totals
OS_C_mortality_totals
rbind(
COVIDSurg_mortality_totals,
OS_NC_mortality_totals,
OS_C_mortality_totals
)
colnames(OS_NC_mortality_totals)<- colnames(COVIDSurg_mortality_totals)
colnames(OS_C_mortality_totals)<- colnames(COVIDSurg_mortality_totals)
#######################################
## Construct mortality-totals table. ##
#######################################
# ----
table_mortality_totals <-
rbind(
COVIDSurg_mortality_totals,
OS_NC_mortality_totals,
OS_C_mortality_totals
)
table_mortality_totals
rownames(table_mortality_totals) <-
c(
"COVIDSurg",
"OS_NC",
"OS_C"
)
table_mortality_totals
