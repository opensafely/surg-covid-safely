dplyr::right_join(weekly_windowed_proportion_7wkPreOpInfection,
by = c("Year_surgery", "Month_surgery"))
View(monthly_windowed_proportion_7wkPreOpInfection)
View(windowed_proportion_7wkPreOpInfection)
View(weekly_windowed_proportion_7wkPreOpInfection)
windowed_proportion_7wkPreOpInfection <-
monthly_windowed_proportion_7wkPreOpInfection %>%
# select(c("Year_surgery", "Month_surgery",
#          "monthly_7wkPreOpInfection",
#          "twoMonthly_7wkPreOpInfection",
#          "threeMonthly_7wkPreOpInfection")) %>%
dplyr::right_join(weekly_windowed_proportion_7wkPreOpInfection,
by = c("Year_surgery", "Month_surgery"))
View(windowed_proportion_7wkPreOpInfection)
# Make timeline backbone.
backbone <-
seq(lubridate::dmy(start), lubridate::dmy(end), by = 'week') %>%
data.frame() %>%
mutate(Year_surgery = lubridate::year(.),
Month_surgery = lubridate::month(., label = T),
Week_surgery = lubridate::week(.))
colnames(backbone)[1] <- "Date"
# Weekly proportion of surgeries conducted more than 7 weeks from a positive
# PCR test for SARS-CoV-2.
relevant_preOperative_infection_status <-
c("0-2 weeks record of pre-operative SARS-CoV-2 infection",
"3-4 weeks record of pre-operative SARS-CoV-2 infection",
"5-6 weeks record of pre-operative SARS-CoV-2 infection")
# Make timeline backbone.
backbone <-
seq(lubridate::dmy(start), lubridate::dmy(end), by = 'week') %>%
data.frame() %>%
mutate(Year_surgery = lubridate::year(.),
Month_surgery = lubridate::month(., label = T),
Week_surgery = lubridate::week(.))
colnames(backbone)[1] <- "Date"
# Weekly proportion of surgeries conducted more than 7 weeks from a positive
# PCR test for SARS-CoV-2.
relevant_preOperative_infection_status <-
c("0-2 weeks record of pre-operative SARS-CoV-2 infection",
"3-4 weeks record of pre-operative SARS-CoV-2 infection",
"5-6 weeks record of pre-operative SARS-CoV-2 infection")
weekly_windowed_proportion_within_7wkPreOpInfection <-
data %>%
group_by(Year_surgery, Month_surgery, Week_surgery) %>%
summarise(
weekly_n = n(),
weekly_n_within_7wk = sum(preOperative_infection_status %in%
relevant_preOperative_infection_status),
weekly_prop_within_7wk = weekly_n_within_7wk / weekly_n
)
# Join to a left backbone of all weeks.
weekly_windowed_proportion_within_7wkPreOpInfection <-
backbone %>% dplyr::left_join(weekly_windowed_proportion_within_7wkPreOpInfection,
by = c("Year_surgery", "Month_surgery",
"Week_surgery")) %>%
tidyr::replace_na(list("weekly_prop_within_7wk" = 0, "weekly_n_within_7wk" = 0,
"weekly_n" = 0))
# Group weekly count by month.
monthly_windowed_proportion_within_7wkPreOpInfection <-
weekly_windowed_proportion_within_7wkPreOpInfection %>%
group_by(Year_surgery, Month_surgery) %>%
summarise(
monthly_n = sum(weekly_n),
monthly_within_7wk = sum(weekly_n_within_7wk),
monthly_within_7wkPreOpInfection = monthly_within_7wk / monthly_n
) %>%
tidyr::replace_na(list("monthly_within_7wkPreOpInfection" = 0))
# Monthly, 2-monthly and 3-monthly counts of 30-day post-operative mortality.
monthly_windowed_proportion_within_7wkPreOpInfection <-
monthly_windowed_proportion_within_7wkPreOpInfection %>%
add_column(
twomonthly_within_7wk =
RcppRoll::roll_sum(.$monthly_within_7wk,
2, fill=NA, align="right")
) %>%
add_column(
twoMonthly_n =
RcppRoll::roll_sum(.$monthly_n,
2, fill=NA, align="right")
) %>%
add_column(
threemonthly_within_7wk =
RcppRoll::roll_sum(.$monthly_within_7wk,
3, fill=NA, align="right")
) %>%
add_column(
threeMonthly_n =
RcppRoll::roll_sum(.$monthly_n,
3, fill=NA, align="right")
) %>%
mutate(
twomonthly_within_7wkPreOpInfection = twomonthly_within_7wk / twoMonthly_n
) %>%
mutate(
threemonthly_within_7wkPreOpInfection = threemonthly_within_7wk / threeMonthly_n
)
windowed_proportion_7wkPreOpInfection <-
monthly_windowed_proportion_within_7wkPreOpInfection %>%
# select(c("Year_surgery", "Month_surgery",
#          "monthly_within_7wkPreOpInfection",
#          "twomonthly_within_7wkPreOpInfection",
#          "threemonthly_within_7wkPreOpInfection")) %>%
dplyr::right_join(weekly_windowed_proportion_within_7wkPreOpInfection
windowed_proportion_7wkPreOpInfection <-
monthly_windowed_proportion_within_7wkPreOpInfection %>%
# select(c("Year_surgery", "Month_surgery",
#          "monthly_within_7wkPreOpInfection",
#          "twomonthly_within_7wkPreOpInfection",
#          "threemonthly_within_7wkPreOpInfection")) %>%
dplyr::right_join(weekly_windowed_proportion_within_7wkPreOpInfection,
by = c("Year_surgery", "Month_surgery"))
backbone <-
seq(lubridate::dmy(start), lubridate::dmy(end), by = 'week') %>%
data.frame() %>%
mutate(Year_surgery = lubridate::year(.),
Month_surgery = lubridate::month(., label = T),
Week_surgery = lubridate::week(.))
colnames(backbone)[1] <- "Date"
# Weekly proportion of surgeries conducted more than 7 weeks from a positive
# PCR test for SARS-CoV-2.
relevant_preOperative_infection_status <-
c("0-2 weeks record of pre-operative SARS-CoV-2 infection",
"3-4 weeks record of pre-operative SARS-CoV-2 infection",
"5-6 weeks record of pre-operative SARS-CoV-2 infection")
weekly_windowed_proportion_within_7wkPreOpInfection <-
data %>%
group_by(Year_surgery, Month_surgery, Week_surgery) %>%
summarise(
weekly_n = n(),
weekly_n_within_7wk = sum(preOperative_infection_status %in%
relevant_preOperative_infection_status),
weekly_prop_within_7wk = weekly_n_within_7wk / weekly_n
)
# Join to a left backbone of all weeks.
weekly_windowed_proportion_within_7wkPreOpInfection <-
backbone %>% dplyr::left_join(weekly_windowed_proportion_within_7wkPreOpInfection,
by = c("Year_surgery", "Month_surgery",
"Week_surgery")) %>%
tidyr::replace_na(list("weekly_prop_within_7wk" = 0, "weekly_n_within_7wk" = 0,
"weekly_n" = 0))
# Group weekly count by month.
monthly_windowed_proportion_within_7wkPreOpInfection <-
weekly_windowed_proportion_within_7wkPreOpInfection %>%
group_by(Year_surgery, Month_surgery) %>%
summarise(
monthly_n = sum(weekly_n),
monthly_within_7wk = sum(weekly_n_within_7wk),
monthly_prop_within_7wk = monthly_within_7wk / monthly_n
) %>%
tidyr::replace_na(list("monthly_prop_within_7wk" = 0))
# Monthly, 2-monthly and 3-monthly counts of 30-day post-operative mortality.
monthly_windowed_proportion_within_7wkPreOpInfection <-
monthly_windowed_proportion_within_7wkPreOpInfection %>%
add_column(
twomonthly_within_7wk =
RcppRoll::roll_sum(.$monthly_within_7wk,
2, fill=NA, align="right")
) %>%
add_column(
twoMonthly_n =
RcppRoll::roll_sum(.$monthly_n,
2, fill=NA, align="right")
) %>%
add_column(
threemonthly_within_7wk =
RcppRoll::roll_sum(.$monthly_within_7wk,
3, fill=NA, align="right")
) %>%
add_column(
threeMonthly_n =
RcppRoll::roll_sum(.$monthly_n,
3, fill=NA, align="right")
) %>%
mutate(
twomonthly_prop_within_7wk = twomonthly_within_7wk / twoMonthly_n
) %>%
mutate(
threemonthly_prop_within_7wk = threemonthly_within_7wk / threeMonthly_n
)
# Join monthly to the weekly dataframe.
windowed_proportion_7wkPreOpInfection <-
monthly_windowed_proportion_within_7wkPreOpInfection %>%
# select(c("Year_surgery", "Month_surgery",
#          "monthly_prop_within_7wk",
#          "twomonthly_prop_within_7wk",
#          "threemonthly_prop_within_7wk")) %>%
dplyr::right_join(weekly_windowed_proportion_within_7wkPreOpInfection,
by = c("Year_surgery", "Month_surgery"))
# Group weekly count by month.
monthly_windowed_proportion_within_7wkPreOpInfection <-
weekly_windowed_proportion_within_7wkPreOpInfection %>%
group_by(Year_surgery, Month_surgery) %>%
summarise(
monthly_n = sum(weekly_n),
monthly_within_7wk = sum(weekly_n_within_7wk),
monthly_prop_within_7wk = monthly_within_7wk / monthly_n
) %>%
tidyr::replace_na(list("monthly_prop_within_7wk" = 0))
# Monthly, 2-monthly and 3-monthly counts of 30-day post-operative mortality.
monthly_windowed_proportion_within_7wkPreOpInfection <-
monthly_windowed_proportion_within_7wkPreOpInfection %>%
add_column(
twoMonthly_n =
RcppRoll::roll_sum(.$monthly_n,
2, fill=NA, align="right")
) %>%
add_column(
twomonthly_within_7wk =
RcppRoll::roll_sum(.$monthly_within_7wk,
2, fill=NA, align="right")
) %>%
mutate(
twomonthly_prop_within_7wk = twomonthly_within_7wk / twoMonthly_n
) %>%
add_column(
threeMonthly_n =
RcppRoll::roll_sum(.$monthly_n,
3, fill=NA, align="right")
) %>%
add_column(
threemonthly_within_7wk =
RcppRoll::roll_sum(.$monthly_within_7wk,
3, fill=NA, align="right")
) %>%
mutate(
threemonthly_prop_within_7wk = threemonthly_within_7wk / threeMonthly_n
)
# Join monthly to the weekly dataframe.
windowed_proportion_7wkPreOpInfection <-
monthly_windowed_proportion_within_7wkPreOpInfection %>%
# select(c("Year_surgery", "Month_surgery",
#          "monthly_prop_within_7wk",
#          "twomonthly_prop_within_7wk",
#          "threemonthly_prop_within_7wk")) %>%
dplyr::right_join(weekly_windowed_proportion_within_7wkPreOpInfection,
by = c("Year_surgery", "Month_surgery"))
windowed_proportion_7wkPreOpInfection <-
weekly_windowed_proportion_within_7wkPreOpInfection %>%
select("Year_surgery", "Month_surgery", "Week_surgery",
"weekly_n", "weekly_n_within_7wk", "weekly_prop_within_7wk"
) %>%
dplyr::left_join(monthly_windowed_proportion_within_7wkPreOpInfection,
by = c("Year_surgery", "Month_surgery"))
# Convert to percentages.
windowed_proportion_7wkPreOpInfection[,c("weekly_prop_within_7wk")]
# Convert to percentages.
proportion_columns <- c("weekly_prop_within_7wk",
"monthly_prop_within_7wk",
"twomonthly_prop_within_7wk",
"threemonthly_prop_within_7wk")
windowed_proportion_7wkPreOpInfection[,proportion_columns]
windowed_proportion_7wkPreOpInfection[,proportion_columns] <-
windowed_proportion_7wkPreOpInfection[,proportion_columns] * 100
View(windowed_proportion_7wkPreOpInfection)
# Load and run the function that does the work.
source(here::here("analysis","fnc_preprintFigure_dataPrep.R"))
OS_C6m_windowed_proportion_7wkPreOpInfection <-
fnc_preprintFigure_dataPrep(data = myData_OS_C6m,
start = startDate,
end = endDate)
OS_NC6m_windowed_proportion_7wkPreOpInfection <-
fnc_preprintFigure_dataPrep(data = myData_OS_NC6m,
start = startDate,
end = endDate)
View(OS_NC6m_windowed_proportion_7wkPreOpInfection)
View(OS_NC6m_windowed_proportion_7wkPreOpInfection)
###################
## Plot the data ##
###################
# ----
# NOTE: Nest horizontal axes require the ggh4x package to be installed.
#
# Load and run the function that does the work.
source(here::here("analysis","fnc_preprintFigure_dataPlot.R"))
###################
## Plot the data ##
###################
# ----
# NOTE: Nest horizontal axes require the ggh4x package to be installed.
#
# Load and run the function that does the work.
source(here::here("analysis","fnc_preprintFigure_dataPlot.R"))
fnc_preprintFigure_dataPlot(data = OS_C6m_windowed_proportion_7wkPreOpInfection,
cohort = "with")
#   3. Mid-January 2021 - Specifically, 8th Dec 2020 + 5 weeks. The 8th December
#      2020 was the first date of SARS-CoV-2 vaccination. We estimated at least
#      three weeks for sufficient vaccine rollout. We added two weeks for the
#      vaccine to take effect, according to efficacy studies
#      (https://www.nejm.org/doi/full/10.1056/nejmoa2034577)
#   4. March 2021 - Another publication by the COVIDSurg Collaborative that
#      detailed the relationship between the 30-post opertative mortality and the
#      interval between a positive PCR test for SARS-CoV-2 and a patient's
#      surgery.
#
library(ggplot2)
library(ggh4x)
library(RcppRoll)
library(tidyverse)
library(lubridate)
fnc_preprintFigure_dataPlot(data = OS_C6m_windowed_proportion_7wkPreOpInfection,
cohort = "with")
data = OS_C6m_windowed_proportion_7wkPreOpInfection;
cohort = "with"
if (cohort == "with") {cancer <- "cancer"}else{cancer <- "noCancer"}
data %>%
ggplot(
aes(x = interaction(Week_surgery, Month_surgery, Year_surgery),
y = weekly_7wkPreOpInfection)) +
geom_col() +
scale_x_discrete(guide = guide_axis_nested(check.overlap = T)) +
scale_y_continuous(limits = c(0, 100),
labels = c(0, 25, 50, 75, 100),
breaks = c(0, 25, 50, 75, 100)) +
theme(panel.grid.major.x = element_blank()) +
ggtitle(paste0("Rolling weekly summary of the proportion of\n",
"surgeries conducted less than 7 weeks from a positive\n",
"PCR test for SARS-CoV-2"),
subtitle = paste0("(Cohort = Patients ", cohort,
" a cancer diagnosis within 6 months of\nsurgery)")) +
ylab("Proportion of surgeries conducted more\n than 7 weeks from a positive PCR test (%)") +
xlab("") +
geom_vline(xintercept = 54) + # Index for March 2020
annotate(x = 54, y = 95, label = "1st COVIDSurg\npublication",  hjust = "right", geom = "label", size = 2) +
geom_vline(xintercept = 56) + # Index for March 2020
annotate(x = 56, y = 75, label = "NICE\nguidelines",  hjust = "right", geom = "label", size = 2) +
geom_vline(xintercept = 98) + # Index for January 2021
annotate(x = 98, y = 70, label = "Estimated\ndate of vaccine\neffectiveness", hjust = "right", geom = "label", size = 2) +
geom_vline(xintercept = 106) + # Index for March 2021
annotate(x = 106, y = 95, label = "2nd COVIDSurg\npublication",  hjust = "right", geom = "label", size = 2) +
theme(plot.title = element_text(size = 8),
plot.subtitle = element_text(size = 7),
axis.title = element_text(size = 10),
axis.text = element_text(size = 10),
axis.line = element_line(colour = "black"))
data %>%
ggplot(
aes(x = interaction(Week_surgery, Month_surgery, Year_surgery),
y = weekly_prop_within_7wk)) +
geom_col() +
scale_x_discrete(guide = guide_axis_nested(check.overlap = T)) +
scale_y_continuous(limits = c(0, 100),
labels = c(0, 25, 50, 75, 100),
breaks = c(0, 25, 50, 75, 100)) +
theme(panel.grid.major.x = element_blank()) +
ggtitle(paste0("Rolling weekly summary of the proportion of\n",
"surgeries conducted less than 7 weeks from a positive\n",
"PCR test for SARS-CoV-2"),
subtitle = paste0("(Cohort = Patients ", cohort,
" a cancer diagnosis within 6 months of\nsurgery)")) +
ylab("Proportion of surgeries conducted more\n than 7 weeks from a positive PCR test (%)") +
xlab("") +
geom_vline(xintercept = 54) + # Index for March 2020
annotate(x = 54, y = 95, label = "1st COVIDSurg\npublication",  hjust = "right", geom = "label", size = 2) +
geom_vline(xintercept = 56) + # Index for March 2020
annotate(x = 56, y = 75, label = "NICE\nguidelines",  hjust = "right", geom = "label", size = 2) +
geom_vline(xintercept = 98) + # Index for January 2021
annotate(x = 98, y = 70, label = "Estimated\ndate of vaccine\neffectiveness", hjust = "right", geom = "label", size = 2) +
geom_vline(xintercept = 106) + # Index for March 2021
annotate(x = 106, y = 95, label = "2nd COVIDSurg\npublication",  hjust = "right", geom = "label", size = 2) +
theme(plot.title = element_text(size = 8),
plot.subtitle = element_text(size = 7),
axis.title = element_text(size = 10),
axis.text = element_text(size = 10),
axis.line = element_line(colour = "black"))
data %>%
ggplot(
aes(x = interaction(Week_surgery, Month_surgery, Year_surgery),
y = weekly_prop_within_7wk)) +
geom_col() +
scale_x_discrete(guide = guide_axis_nested(check.overlap = T)) +
scale_y_continuous(limits = c(0, 100),
labels = c(0, 25, 50, 75, 100),
breaks = c(0, 25, 50, 75, 100)) +
theme(panel.grid.major.x = element_blank()) +
ggtitle(paste0("Rolling weekly summary of the proportion of\n",
"surgeries conducted less than 7 weeks from a positive\n",
"PCR test for SARS-CoV-2"),
subtitle = paste0("(Cohort = Patients ", cohort,
" a cancer diagnosis within 6 months of\nsurgery)")) +
ylab("Proportion of surgeries conducted less\n than 7 weeks from a positive PCR test (%)") +
xlab("") +
geom_vline(xintercept = 54) + # Index for March 2020
annotate(x = 54, y = 95, label = "1st COVIDSurg\npublication",  hjust = "right", geom = "label", size = 2) +
geom_vline(xintercept = 56) + # Index for March 2020
annotate(x = 56, y = 75, label = "NICE\nguidelines",  hjust = "right", geom = "label", size = 2) +
geom_vline(xintercept = 98) + # Index for January 2021
annotate(x = 98, y = 70, label = "Estimated\ndate of vaccine\neffectiveness", hjust = "right", geom = "label", size = 2) +
geom_vline(xintercept = 106) + # Index for March 2021
annotate(x = 106, y = 95, label = "2nd COVIDSurg\npublication",  hjust = "right", geom = "label", size = 2) +
theme(plot.title = element_text(size = 8),
plot.subtitle = element_text(size = 7),
axis.title = element_text(size = 10),
axis.text = element_text(size = 10),
axis.line = element_line(colour = "black"))
data %>%
group_by(Year_surgery, Month_surgery) %>%
summarise(monthly_7wkPreOpInfection = median(monthly_7wkPreOpInfection)) %>%
select(Year_surgery, Month_surgery, monthly_7wkPreOpInfection) %>%
ggplot(.,
aes(x = interaction(Month_surgery, Year_surgery),
y = monthly_prop_within_7wk)) +
geom_col() +
scale_x_discrete(guide = guide_axis_nested(check.overlap = T)) +
scale_y_continuous(limits = c(0, 100),
labels = c(0, 25, 50, 75, 100),
breaks = c(0, 25, 50, 75, 100)) +
ggtitle(paste0("Rolling monthly summary of the proportion of\n",
"surgeries conducted less than 7 weeks from a positive\n",
"PCR test for SARS-CoV-2"),
subtitle = paste0("(Cohort = Patients ", cohort,
" a cancer diagnosis within 6 months of\nsurgery)")) +
ylab("Proportion of surgeries conducted less\n than 7 weeks from a positive PCR test (%)") +
xlab("") +
geom_vline(xintercept = 13) + # Index for March 2020
annotate(x = 13, y = 95, label = "1st COVIDSurg\npublication",  hjust = "right", geom = "label", size = 2) +
annotate(x = 13, y = 75, label = "NICE\nguidelines",  hjust = "right", geom = "label", size = 2) +
geom_vline(xintercept = 23) + # Index for January 2021
annotate(x = 23, y = 70, label = "Estimated\ndate of vaccine\neffectiveness", hjust = "right", geom = "label", size = 2) +
geom_vline(xintercept = 25) + # Index for March 2021
annotate(x = 25, y = 95, label = "2nd COVIDSurg\npublication",  hjust = "right", geom = "label", size = 2) +
theme(plot.title = element_text(size = 8),
plot.subtitle = element_text(size = 7),
axis.title = element_text(size = 10),
axis.text = element_text(size = 10),
axis.line = element_line(colour = "black"))
data %>%
group_by(Year_surgery, Month_surgery) %>%
summarise(monthly_prop_within_7wk = median(monthly_prop_within_7wk)) %>%
select(Year_surgery, Month_surgery, monthly_prop_within_7wk) %>%
ggplot(.,
aes(x = interaction(Month_surgery, Year_surgery),
y = monthly_prop_within_7wk)) +
geom_col() +
scale_x_discrete(guide = guide_axis_nested(check.overlap = T)) +
scale_y_continuous(limits = c(0, 100),
labels = c(0, 25, 50, 75, 100),
breaks = c(0, 25, 50, 75, 100)) +
ggtitle(paste0("Rolling monthly summary of the proportion of\n",
"surgeries conducted less than 7 weeks from a positive\n",
"PCR test for SARS-CoV-2"),
subtitle = paste0("(Cohort = Patients ", cohort,
" a cancer diagnosis within 6 months of\nsurgery)")) +
ylab("Proportion of surgeries conducted less\n than 7 weeks from a positive PCR test (%)") +
xlab("") +
geom_vline(xintercept = 13) + # Index for March 2020
annotate(x = 13, y = 95, label = "1st COVIDSurg\npublication",  hjust = "right", geom = "label", size = 2) +
annotate(x = 13, y = 75, label = "NICE\nguidelines",  hjust = "right", geom = "label", size = 2) +
geom_vline(xintercept = 23) + # Index for January 2021
annotate(x = 23, y = 70, label = "Estimated\ndate of vaccine\neffectiveness", hjust = "right", geom = "label", size = 2) +
geom_vline(xintercept = 25) + # Index for March 2021
annotate(x = 25, y = 95, label = "2nd COVIDSurg\npublication",  hjust = "right", geom = "label", size = 2) +
theme(plot.title = element_text(size = 8),
plot.subtitle = element_text(size = 7),
axis.title = element_text(size = 10),
axis.text = element_text(size = 10),
axis.line = element_line(colour = "black"))
data %>%
group_by(Year_surgery, Month_surgery) %>%
summarise(threeMonthly_prop_within_7wk = median(threeMonthly_prop_within_7wk)) %>%
select(Year_surgery, Month_surgery, threeMonthly_prop_within_7wk) %>%
ggplot(.,
aes(x = interaction(Month_surgery, Year_surgery),
y = threeMonthly_prop_within_7wk)) +
geom_col() +
scale_x_discrete(guide = guide_axis_nested(check.overlap = T)) +
scale_y_continuous(limits = c(0, 100),
labels = c(0, 25, 50, 75, 100),
breaks = c(0, 25, 50, 75, 100)) +
ggtitle(paste0("Rolling three-monthly summary of the proportion of\n",
"surgeries conducted less than 7 weeks from a positive\n",
"PCR test for SARS-CoV-2"),
subtitle = paste0("(Cohort = Patients ", cohort,
" a cancer diagnosis within 6 months of\nsurgery)")) +
ylab("Proportion of surgeries conducted less\n than 7 weeks from a positive PCR test (%)") +
xlab("") +
geom_vline(xintercept = 13) + # Index for March 2020
annotate(x = 13, y = 95, label = "1st COVIDSurg\npublication",  hjust = "right", geom = "label", size = 2) +
annotate(x = 13, y = 75, label = "NICE\nguidelines",  hjust = "right", geom = "label", size = 2) +
geom_vline(xintercept = 23) + # Index for January 2021
annotate(x = 23, y = 70, label = "Estimated\ndate of vaccine\neffectiveness", hjust = "right", geom = "label", size = 2) +
geom_vline(xintercept = 25) + # Index for March 2021
annotate(x = 25, y = 95, label = "2nd COVIDSurg\npublication",  hjust = "right", geom = "label", size = 2) +
theme(plot.title = element_text(size = 8),
plot.subtitle = element_text(size = 7),
axis.title = element_text(size = 10),
axis.text = element_text(size = 10),
axis.line = element_line(colour = "black"))
# Load and run the function that does the work.
source(here::here("analysis","fnc_preprintFigure_dataPrep.R"))
OS_C6m_windowed_proportion_7wkPreOpInfection <-
fnc_preprintFigure_dataPrep(data = myData_OS_C6m,
start = startDate,
end = endDate)
OS_NC6m_windowed_proportion_7wkPreOpInfection <-
fnc_preprintFigure_dataPrep(data = myData_OS_NC6m,
start = startDate,
end = endDate)
###################
## Plot the data ##
###################
# ----
# NOTE: Nest horizontal axes require the ggh4x package to be installed.
#
# Load and run the function that does the work.
source(here::here("analysis","fnc_preprintFigure_dataPlot.R"))
fnc_preprintFigure_dataPlot(data = OS_C6m_windowed_proportion_7wkPreOpInfection,
cohort = "with")
fnc_preprintFigure_dataPlot(data = OS_NC6m_windowed_proportion_7wkPreOpInfection,
cohort = "without")
View(OS_NC6m_windowed_proportion_7wkPreOpInfection)
View(OS_NC6m_windowed_proportion_7wkPreOpInfection)
