file = here::here("output","table1_diabetes.csv")
)
write.csv(
x = table1_chronic_respiratory_disease,
file = here::here("output","table1_chronic_respiratory_disease.csv")
)
# ----
###########################################
# Make vectors to inform the kable table. #
###########################################
# ----
# Pre-March 2020 totals.
# ## Age band.
n_preMarch2020_ageGroup <-
table1_ageGroup %>%
dplyr::filter(era=="Pre-pandemic") %>%
dplyr::arrange(age_group_surgery) %>% dplyr::ungroup() %>% dplyr::select(n_per_group)
View(n_preMarch2020_ageGroup)
# ## Sex.
n_preMarch2020_Sex <-
table1_Sex %>%
dplyr::filter(era=="Pre-pandemic") %>%
dplyr::arrange(Sex) %>% dplyr::ungroup() %>%
dplyr::select(n_per_group)
prop_preMarch2020_Sex <- n_preMarch2020_Sex /
table1_Sex %>%
dplyr::filter(era=="Pre-pandemic") %>%
select(n_per_group) %>% sum()
# ## 30-day post-operative mortality.
n_preMarch2020_postOp_mortality_30day <-
table1_postOp_mortality_30day %>%
dplyr::filter(era=="Pre-pandemic",
(postOp_mortality_30day=="Alive within 30-day post-operation"|
postOp_mortality_30day=="Dead within 30-day post-operation"|
postOp_mortality_30day=="Missing")) %>%
dplyr::arrange(postOp_mortality_30day) %>% dplyr::ungroup() %>%
dplyr::select(n_per_group)
prop_preMarch2020_postOp_mortality_30day <-
n_preMarch2020_postOp_mortality_30day /
table1_postOp_mortality_30day %>%
dplyr::filter(era=="Pre-pandemic") %>%
select(n_per_group) %>% sum()
View(table1_chronic_cardiac_disease)
# ## Chronic cardiac disease.
n_preMarch2020_chronic_cardiac_disease <-
table1_chronic_cardiac_disease %>%
dplyr::filter(era=="Pre-pandemic",
(chronic_cardiac_disease=="Yes"|
chronic_cardiac_disease=="No"|
chronic_cardiac_disease=="Missing")) %>%
dplyr::arrange(chronic_cardiac_disease) %>% dplyr::ungroup() %>%
dplyr::select(n_per_group)
prop_preMarch2020_chronic_cardiac_disease <-
n_preMarch2020_chronic_cardiac_disease /
table1_chronic_cardiac_disease %>%
dplyr::filter(era=="Pre-pandemic") %>%
select(n_per_group) %>% sum()
prop_preMarch2020_chronic_cardiac_disease
n_preMarch2020_chronic_cardiac_disease
table1_chronic_cardiac_disease
table1_chronic_cardiac_disease %>%
dplyr::filter(era=="Pre-pandemic",
(chronic_cardiac_disease=="Yes"|
chronic_cardiac_disease=="No"|
chronic_cardiac_disease=="Missing"))
# ## table1_chronic_cardiac_disease.
table1_chronic_cardiac_disease <-
expand.grid(
era =
c("Error: No surgery", "Pre-pandemic", "Pandemic no vaccine", "Pandemic with vaccine"),
chronic_cardiac_disease =
c("Yes",
"No",
"Missing")) %>%
dplyr::full_join(table1_chronic_cardiac_disease) %>%
dplyr::arrange(era) %>%
tidyr::replace_na(list("n_per_group" = 0,
"n_infection_none" = 0,
"n_infection_0to2wk" = 0,
"n_infection_3to4wk" = 0,
"n_infection_5to6wk" = 0,
"n_infection_7wk" = 0))
# ## table1_diabetes.
table1_diabetes <-
expand.grid(
era =
c("Error: No surgery", "Pre-pandemic", "Pandemic no vaccine", "Pandemic with vaccine"),
diabetes =
c("Yes",
"No",
"Missing")) %>%
dplyr::full_join(table1_diabetes) %>%
dplyr::arrange(era) %>%
tidyr::replace_na(list("n_per_group" = 0,
"n_infection_none" = 0,
"n_infection_0to2wk" = 0,
"n_infection_3to4wk" = 0,
"n_infection_5to6wk" = 0,
"n_infection_7wk" = 0))
# ## table1_chronic_respiratory_disease.
table1_chronic_respiratory_disease <-
expand.grid(
era =
c("Error: No surgery", "Pre-pandemic", "Pandemic no vaccine", "Pandemic with vaccine"),
chronic_respiratory_disease =
c("Yes",
"No",
"Missing")) %>%
dplyr::full_join(table1_chronic_respiratory_disease) %>%
dplyr::arrange(era) %>%
tidyr::replace_na(list("n_per_group" = 0,
"n_infection_none" = 0,
"n_infection_0to2wk" = 0,
"n_infection_3to4wk" = 0,
"n_infection_5to6wk" = 0,
"n_infection_7wk" = 0))
# ## Chronic cardiac disease.
n_preMarch2020_chronic_cardiac_disease <-
table1_chronic_cardiac_disease %>%
dplyr::filter(era=="Pre-pandemic",
(chronic_cardiac_disease=="Yes"|
chronic_cardiac_disease=="No"|
chronic_cardiac_disease=="Missing")) %>%
dplyr::arrange(chronic_cardiac_disease) %>% dplyr::ungroup() %>%
dplyr::select(n_per_group)
n_preMarch2020_chronic_cardiac_disease
table1_chronic_cardiac_disease %>%
dplyr::filter(era=="Pre-pandemic",
(chronic_cardiac_disease=="Yes"|
chronic_cardiac_disease=="No"|
chronic_cardiac_disease=="Missing"))
################################################
# Make tibbles that will inform Table 1, for   #
# the data relating to the 4 week on-boarding. #
################################################
# ----
myData_noConstraints <- myData
# ## Count  of patients in each of the categories for
# ## pre-operative infection status:
# ##    1. "No record of pre-operative SARS-CoV-2 infection"
# ##    2. "0-2 weeks record of pre-operative SARS-CoV-2 infection"
# ##    3. "3-4 weeks record of pre-operative SARS-CoV-2 infection"
# ##    4. "5-6 weeks record of pre-operative SARS-CoV-2 infection"
# ##    5. ">=7 weeks record of pre-operative SARS-CoV-2 infection"
# ##    6. "Error: Test result after surgery. Check study_definition."
# ##
# ## The counts are also stratified by surgery era:
# ##    1. "preCOVID sugery"
# ##    2. "postCOVID surgery" (although labelled "post", this means during, too)
# ##    3. "No surgery"
table1_totals_preOp_infection_status <-
myData_noConstraints %>% dplyr::group_by(era,
preOperative_infection_status) %>% dplyr::summarise(n = n())
# ## Count of patients in each of the categories for pre-operative infection
# ## status (stratified by surgery era; see above) also stratified by age band:
# ##    1. 0-29
# ##    2. 30-49
# ##    3. 50-69
# ##    4. 70-79
# ##    5. 80+
table1_ageGroup <-
myData_noConstraints %>% dplyr::group_by(era, age_group_surgery) %>%
dplyr::summarise(n_per_group = sum(ifelse(preOperative_infection_status!=
"Error: Test result after surgery. Check study_definition.",1,0)),
n_infection_none = sum(ifelse(preOperative_infection_status==
"No record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_0to2wk = sum(ifelse(preOperative_infection_status==
"0-2 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_3to4wk = sum(ifelse(preOperative_infection_status==
"3-4 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_5to6wk = sum(ifelse(preOperative_infection_status==
"5-6 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_7wk = sum(ifelse(preOperative_infection_status==
">=7 weeks record of pre-operative SARS-CoV-2 infection",1,0))
)
# ## Count of patients in each of the categories for pre-operative infection
# ## status (stratified by surgery era; see above) also stratified by sex:
# ##    1. Female
# ##    2. Male
table1_Sex <-
myData_noConstraints %>% dplyr::group_by(era, Sex) %>%
dplyr::summarise(n_per_group = sum(ifelse(preOperative_infection_status!=
"Error: Test result after surgery. Check study_definition.",1,0)),
n_infection_none = sum(ifelse(preOperative_infection_status==
"No record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_0to2wk = sum(ifelse(preOperative_infection_status==
"0-2 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_3to4wk = sum(ifelse(preOperative_infection_status==
"3-4 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_5to6wk = sum(ifelse(preOperative_infection_status==
"5-6 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_7wk = sum(ifelse(preOperative_infection_status==
">=7 weeks record of pre-operative SARS-CoV-2 infection",1,0))
)
# ## Count of patients in each of the categories for pre-operative infection
# ## status (stratified by surgery era; see above) also stratified by whether
# ## or not the patient died within 30 days of their surgery:
# ##    1. "Alive within 30-day post-operation"
# ##    2. "Dead within 30-day post-operation"
# ##    3. "Error: Surgery after death"
# ##    4. "No surgery recorded"
# ##    5. "No death recorded"
table1_postOp_mortality_30day <-
myData_noConstraints %>% dplyr::group_by(era, postOp_mortality_30day) %>%
dplyr::summarise(n_per_group = sum(ifelse(preOperative_infection_status!=
"Error: Test result after surgery. Check study_definition.",1,0)),
n_infection_none = sum(ifelse(preOperative_infection_status==
"No record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_0to2wk = sum(ifelse(preOperative_infection_status==
"0-2 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_3to4wk = sum(ifelse(preOperative_infection_status==
"3-4 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_5to6wk = sum(ifelse(preOperative_infection_status==
"5-6 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_7wk = sum(ifelse(preOperative_infection_status==
">=7 weeks record of pre-operative SARS-CoV-2 infection",1,0))
)
# ## Count of patients in each of the categories for pre-operative infection
# ## status (stratified by surgery era; see above) also stratified by whether
# ## or not the patient had a record of chronic cardiac disease before their surgery.
# ##    1. Yes
# ##    1. No
table1_chronic_cardiac_disease <-
myData_noConstraints %>% dplyr::group_by(era, chronic_cardiac_disease) %>%
dplyr::summarise(n_per_group = sum(ifelse(preOperative_infection_status!=
"Error: Test result after surgery. Check study_definition.",1,0)),
n_infection_none = sum(ifelse(preOperative_infection_status==
"No record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_0to2wk = sum(ifelse(preOperative_infection_status==
"0-2 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_3to4wk = sum(ifelse(preOperative_infection_status==
"3-4 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_5to6wk = sum(ifelse(preOperative_infection_status==
"5-6 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_7wk = sum(ifelse(preOperative_infection_status==
">=7 weeks record of pre-operative SARS-CoV-2 infection",1,0))
)
# ## Count of patients in each of the categories for pre-operative infection
# ## status (stratified by surgery era; see above) also stratified by whether
# ## or not the patient had a record of diabetes before their surgery.
# ##    1. Yes
# ##    1. No
table1_diabetes <-
myData_noConstraints %>% dplyr::group_by(era, diabetes) %>%
dplyr::summarise(n_per_group = sum(ifelse(preOperative_infection_status!=
"Error: Test result after surgery. Check study_definition.",1,0)),
n_infection_none = sum(ifelse(preOperative_infection_status==
"No record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_0to2wk = sum(ifelse(preOperative_infection_status==
"0-2 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_3to4wk = sum(ifelse(preOperative_infection_status==
"3-4 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_5to6wk = sum(ifelse(preOperative_infection_status==
"5-6 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_7wk = sum(ifelse(preOperative_infection_status==
">=7 weeks record of pre-operative SARS-CoV-2 infection",1,0))
)
# ## Count of patients in each of the categories for pre-operative infection
# ## status (stratified by surgery era; see above) also stratified by whether
# ## or not the patient had a record of chronic respiratory disease before their surgery.
# ##    1. Yes
# ##    1. No
table1_chronic_respiratory_disease <-
myData_noConstraints %>% dplyr::group_by(era, chronic_respiratory_disease) %>%
dplyr::summarise(n_per_group = sum(ifelse(preOperative_infection_status!=
"Error: Test result after surgery. Check study_definition.",1,0)),
n_infection_none = sum(ifelse(preOperative_infection_status==
"No record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_0to2wk = sum(ifelse(preOperative_infection_status==
"0-2 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_3to4wk = sum(ifelse(preOperative_infection_status==
"3-4 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_5to6wk = sum(ifelse(preOperative_infection_status==
"5-6 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_7wk = sum(ifelse(preOperative_infection_status==
">=7 weeks record of pre-operative SARS-CoV-2 infection",1,0))
)
# ----
#######################################################################
# Ensure tibbles show zero values when categories are not in the data #
#######################################################################
# ----
# ## table1_totals_preOp_infection_status.
table1_totals_preOp_infection_status <-
expand.grid(
era =
c("Error: No surgery", "Pre-pandemic", "Pandemic no vaccine", "Pandemic with vaccine"),
"preOperative_infection_status" =
c("Error: Test result after surgery. Check study_definition.",
"No record of pre-operative SARS-CoV-2 infection",
"0-2 weeks record of pre-operative SARS-CoV-2 infection",
"3-4 weeks record of pre-operative SARS-CoV-2 infection",
"5-6 weeks record of pre-operative SARS-CoV-2 infection",
">=7 weeks record of pre-operative SARS-CoV-2 infection")) %>%
dplyr::full_join(table1_totals_preOp_infection_status) %>%
dplyr::arrange(era) %>%
tidyr::replace_na(list("n" = 0))
# ## table1_ageGroup.
table1_ageGroup <-
expand.grid(
era =
c("Error: No surgery", "Pre-pandemic", "Pandemic no vaccine", "Pandemic with vaccine"),
age_group_surgery =
c("0-29",
"30-49",
"50-69",
"70-79",
"80+",
"Missing")) %>%
dplyr::full_join(table1_ageGroup) %>%
dplyr::arrange(era) %>%
tidyr::replace_na(list("n_per_group" = 0,
"n_infection_none" = 0,
"n_infection_0to2wk" = 0,
"n_infection_3to4wk" = 0,
"n_infection_5to6wk" = 0,
"n_infection_7wk" = 0))
# ## table1_Sex.
table1_Sex <-
expand.grid(
era =
c("Error: No surgery", "Pre-pandemic", "Pandemic no vaccine", "Pandemic with vaccine"),
Sex =
c("Female",
"Male",
"Missing")) %>%
dplyr::full_join(table1_Sex) %>%
dplyr::arrange(era) %>%
tidyr::replace_na(list("n_per_group" = 0,
"n_infection_none" = 0,
"n_infection_0to2wk" = 0,
"n_infection_3to4wk" = 0,
"n_infection_5to6wk" = 0,
"n_infection_7wk" = 0))
# ## table1_postOp_mortality_30day.
table1_postOp_mortality_30day <-
expand.grid(
era =
c("Error: No surgery", "Pre-pandemic", "Pandemic no vaccine", "Pandemic with vaccine"),
postOp_mortality_30day =
c("Alive within 30-day post-operation",
"Dead within 30-day post-operation",
"Error: Surgery after death",
"No death recorded",
"No surgery recorded",
"Missing")) %>%
dplyr::full_join(table1_postOp_mortality_30day) %>%
dplyr::arrange(era) %>%
tidyr::replace_na(list("n_per_group" = 0,
"n_infection_none" = 0,
"n_infection_0to2wk" = 0,
"n_infection_3to4wk" = 0,
"n_infection_5to6wk" = 0,
"n_infection_7wk" = 0))
# ## table1_chronic_cardiac_disease.
table1_chronic_cardiac_disease <-
expand.grid(
era =
c("Error: No surgery", "Pre-pandemic", "Pandemic no vaccine", "Pandemic with vaccine"),
chronic_cardiac_disease =
c("Yes",
"No",
"Missing")) %>%
dplyr::full_join(table1_chronic_cardiac_disease) %>%
dplyr::arrange(era) %>%
tidyr::replace_na(list("n_per_group" = 0,
"n_infection_none" = 0,
"n_infection_0to2wk" = 0,
"n_infection_3to4wk" = 0,
"n_infection_5to6wk" = 0,
"n_infection_7wk" = 0))
# ## table1_diabetes.
table1_diabetes <-
expand.grid(
era =
c("Error: No surgery", "Pre-pandemic", "Pandemic no vaccine", "Pandemic with vaccine"),
diabetes =
c("Yes",
"No",
"Missing")) %>%
dplyr::full_join(table1_diabetes) %>%
dplyr::arrange(era) %>%
tidyr::replace_na(list("n_per_group" = 0,
"n_infection_none" = 0,
"n_infection_0to2wk" = 0,
"n_infection_3to4wk" = 0,
"n_infection_5to6wk" = 0,
"n_infection_7wk" = 0))
# ## table1_chronic_respiratory_disease.
table1_chronic_respiratory_disease <-
expand.grid(
era =
c("Error: No surgery", "Pre-pandemic", "Pandemic no vaccine", "Pandemic with vaccine"),
chronic_respiratory_disease =
c("Yes",
"No",
"Missing")) %>%
dplyr::full_join(table1_chronic_respiratory_disease) %>%
dplyr::arrange(era) %>%
tidyr::replace_na(list("n_per_group" = 0,
"n_infection_none" = 0,
"n_infection_0to2wk" = 0,
"n_infection_3to4wk" = 0,
"n_infection_5to6wk" = 0,
"n_infection_7wk" = 0))
# ----
# ## Chronic cardiac disease.
n_preMarch2020_chronic_cardiac_disease <-
table1_chronic_cardiac_disease %>%
dplyr::filter(era=="Pre-pandemic",
(chronic_cardiac_disease=="Yes"|
chronic_cardiac_disease=="No"|
chronic_cardiac_disease=="Missing")) %>%
dplyr::arrange(chronic_cardiac_disease) %>% dplyr::ungroup() %>%
dplyr::select(n_per_group)
n_preMarch2020_chronic_cardiac_disease
prop_preMarch2020_chronic_cardiac_disease <-
n_preMarch2020_chronic_cardiac_disease /
table1_chronic_cardiac_disease %>%
dplyr::filter(era=="Pre-pandemic") %>%
select(n_per_group) %>% sum()
# ## Diabetes.
n_preMarch2020_diabetes <-
table1_diabetes %>%
dplyr::filter(era=="Pre-pandemic",
(diabetes=="Yes"|
diabetes=="No"|
diabetes=="Missing")) %>%
dplyr::arrange(diabetes) %>% dplyr::ungroup() %>%
dplyr::select(n_per_group)
prop_preMarch2020_diabetes <-
n_preMarch2020_diabetes /
table1_diabetes %>%
dplyr::filter(era=="Pre-pandemic") %>%
select(n_per_group) %>% sum()
# ## Chronic cardiac disease.
n_preMarch2020_chronic_respiratory_disease <-
table1_chronic_respiratory_disease %>%
dplyr::filter(era=="Pre-pandemic",
(chronic_respiratory_disease=="Yes"|
chronic_respiratory_disease=="No"|
chronic_cardiac_disease=="Missing")) %>%
dplyr::arrange(chronic_respiratory_disease) %>% dplyr::ungroup() %>%
dplyr::select(n_per_group)
prop_preMarch2020_chronic_respiratory_disease <-
n_preMarch2020_chronic_respiratory_disease /
table1_chronic_respiratory_disease %>%
dplyr::filter(era=="Pre-pandemic") %>%
select(n_per_group) %>% sum()
# ## Totals. `n` is count. `prop` is proportion.
n_totals_preMarch2020 <-
rbind(n_preMarch2020_ageGroup,
n_preMarch2020_Sex,
n_preMarch2020_postOp_mortality_30day,
n_preMarch2020_chronic_cardiac_disease,
n_preMarch2020_diabetes,
n_preMarch2020_chronic_respiratory_disease)
# ## Chronic respiratory disease.
n_preMarch2020_chronic_respiratory_disease <-
table1_chronic_respiratory_disease %>%
dplyr::filter(era=="Pre-pandemic",
(chronic_respiratory_disease=="Yes"|
chronic_respiratory_disease=="No"|
chronic_cardiac_disease=="Missing")) %>%
dplyr::arrange(chronic_respiratory_disease) %>% dplyr::ungroup() %>%
dplyr::select(n_per_group)
View(table1_chronic_respiratory_disease)
table1_chronic_respiratory_disease
# ## Chronic respiratory disease.
n_preMarch2020_chronic_respiratory_disease <-
table1_chronic_respiratory_disease %>%
dplyr::filter(era=="Pre-pandemic",
(chronic_respiratory_disease=="Yes"|
chronic_respiratory_disease=="No"|
chronic_cardiac_disease=="Missing")) %>%
dplyr::arrange(chronic_respiratory_disease) %>% dplyr::ungroup() %>%
dplyr::select(n_per_group)
table1_chronic_respiratory_disease %>%
dplyr::filter(era=="Pre-pandemic",
(chronic_respiratory_disease=="Yes"|
chronic_respiratory_disease=="No"|
chronic_cardiac_disease=="Missing"))
colnames(table1_chronic_respiratory_disease)
# ## Chronic respiratory disease.
n_preMarch2020_chronic_respiratory_disease <-
table1_chronic_respiratory_disease %>%
dplyr::filter(era=="Pre-pandemic",
(chronic_respiratory_disease=="Yes"|
chronic_respiratory_disease=="No"|
chronic_respiratory_disease=="Missing")) %>%
dplyr::arrange(chronic_respiratory_disease) %>% dplyr::ungroup() %>%
dplyr::select(n_per_group)
prop_preMarch2020_chronic_respiratory_disease <-
n_preMarch2020_chronic_respiratory_disease /
table1_chronic_respiratory_disease %>%
dplyr::filter(era=="Pre-pandemic") %>%
select(n_per_group) %>% sum()
# ## Totals. `n` is count. `prop` is proportion.
n_totals_preMarch2020 <-
rbind(n_preMarch2020_ageGroup,
n_preMarch2020_Sex,
n_preMarch2020_postOp_mortality_30day,
n_preMarch2020_chronic_cardiac_disease,
n_preMarch2020_diabetes,
n_preMarch2020_chronic_respiratory_disease)
prop_totals_preMarch2020 <-
rbind(prop_preMarch2020_ageGroup,
prop_preMarch2020_Sex,
prop_preMarch2020_postOp_mortality_30day,
prop_preMarch2020_chronic_cardiac_disease,
prop_preMarch2020_diabetes,
prop_preMarch2020_chronic_respiratory_disease)
