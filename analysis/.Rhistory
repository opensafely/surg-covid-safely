"Confirmed not vaccinated before test",
# Previous criteria imply the 2nd dose is F or NA.
TRUE ~ "Unknown vaccination status before test"
)
)
# This second pipeline is separate from the first because it uses variables
# created in the first pipeline.
myData <- myData %>%
## Indicator for 30-day post-operative mortality.
## # NB: if the list of possible categories changes, the list will
## #     need to be updated in Make_Table1.R, too.
dplyr::mutate(
postOp_mortality_30day = dplyr::case_when(
(.$date_death < .$date_surgery) ~ "Error: Surgery after death",
(.$date_death - .$date_surgery) <= 30 ~ "Dead within 30-day post-operation",
(.$date_death - .$date_surgery) > 30 ~ "Alive within 30-day post-operation",
is.na(.$date_death) ~ "No death recorded",
is.na(.$date_surgery) ~ "No surgery recorded"
)
) %>%
## Month of surgery.
dplyr::mutate(Month_surgery = lubridate::month(lubridate::ymd(.$date_surgery), label = T)) %>%
## Year of surgery.
dplyr::mutate(Year_surgery = lubridate::year(.$date_surgery)) %>%
## No record of indication of pre-operative SARS-CoV-2 infection.
## # NB: if the list of possible categories changes, the list will
## #     need to be updated in Make_Table1.R, too.
dplyr::mutate(
preOperative_infection_status = dplyr::case_when(
(.$date_surgery - .$date_latest_test_preOp_SARS_CoV_2_outcome_positive) <0 ~
"Error: Test result after surgery. Check study_definition.",
(.$date_surgery - .$date_latest_test_preOp_SARS_CoV_2_outcome_positive) == 0 ~
"Positive test and surgery on the same day. Surgery event excluded",
!is.na(.$date_latest_test_preOp_SARS_CoV_2_outcome_positive) &
abs(.$date_surgery - .$date_latest_test_preOp_SARS_CoV_2_outcome_positive) > 0 &
abs(.$date_surgery - .$date_latest_test_preOp_SARS_CoV_2_outcome_positive) < 14 ~
"0-2 weeks record of pre-operative SARS-CoV-2 infection",
!is.na(.$date_latest_test_preOp_SARS_CoV_2_outcome_positive) &
abs(.$date_surgery - .$date_latest_test_preOp_SARS_CoV_2_outcome_positive) > 15 &
abs(.$date_surgery - .$date_latest_test_preOp_SARS_CoV_2_outcome_positive) < 28 ~
"3-4 weeks record of pre-operative SARS-CoV-2 infection",
!is.na(.$date_latest_test_preOp_SARS_CoV_2_outcome_positive) &
abs(.$date_surgery - .$date_latest_test_preOp_SARS_CoV_2_outcome_positive) > 29 &
abs(.$date_surgery - .$date_latest_test_preOp_SARS_CoV_2_outcome_positive) < 42 ~
"5-6 weeks record of pre-operative SARS-CoV-2 infection",
!is.na(.$date_latest_test_preOp_SARS_CoV_2_outcome_positive) &
abs(.$date_surgery - .$date_latest_test_preOp_SARS_CoV_2_outcome_positive) >= 49 ~
">=7 weeks record of pre-operative SARS-CoV-2 infection",
TRUE ~ "No record of pre-operative SARS-CoV-2 infection"
)
) %>% dplyr::mutate_if(is.character,as.factor)
# ----
################################################
## Hardcode values from COVIDSurg publication ##
################################################
# ----
## Source is Table 1 from doi = 10.1111/anae.15458.
# Counts of patients, across intervals.
COVIDSurg_totals <- data.frame(
n_total = NA,
n_no_infection = 137104,
n_infection_0to2wk = 1138,
n_infection_3to4wk = 461,
n_infection_5to6wk = 326,
n_infection_7wk = 1202
)
COVIDSurg_totals$n_total <- sum(COVIDSurg_totals, na.rm = T)
# Counts of 30-day post-operative mortality, across intervals.
intervals_COVIDSurg_values <- data.frame(
n_no_infection = 3654,
pct_no_infection = NA,
n_infection_0to2wk = 149,
pct_infection_0to2wk = NA,
n_infection_3to4wk = 60,
pct_infection_3to4wk = NA,
n_infection_5to6wk = 33,
pct_infection_5to6wk = NA,
n_infection_7wk = 42,
pct_infection_7wk = NA
)
# Percentages of 30-day post-operative mortality, across intervals.
intervals_COVIDSurg_values[seq(2,10,2)] <-
(intervals_COVIDSurg_values[seq(1,10,2)] /
COVIDSurg_totals[2:ncol(COVIDSurg_totals)]) * 100
# Counts of 30-day post-operative mortality, across era.
era_COVIDSurg_values <- data.frame(
n_PrePandemic = NA,
pct_PrePandemic = NA,
n_PandemicNoVacc = sum(intervals_COVIDSurg_values[seq(1,10,2)]),
pct_PandemicNoVacc = NA,
n_PandemicWithVacc = NA,
pct_PandemicWithVacc = NA
)
# Percentages of 30-day post-operative mortality, across total.
era_COVIDSurg_values$pct_PandemicNoVacc <-
(era_COVIDSurg_values$n_PandemicNoVacc / COVIDSurg_totals$n_total) * 100
# ----
#####################
## Filter datasets ##
#####################
# ----
# Filter the dataset for patients with a record of a cancer diagnosis within
# 6 months before or after their surgery.
# OpenSAFELY data, no-cancer patients.
myData_OS_C <- myData %>%
dplyr::filter(category_cancer_within_6mths_surgery ==
"Cancer diagnosis within 6mths before surgery" |
category_cancer_within_6mths_surgery ==
"Cancer diagnosis within 6mths after surgery")
# OpenSAFELY data, cancer patients.
myData_OS_NC <- myData %>%
dplyr::filter(category_cancer_within_6mths_surgery ==
"No cancer diagnosis within 6mths before or after surgery")
# ----
## #  OpenSAFELY data, no-cancer patients. ----
totals_OS_NC <-
myData_OS_NC %>%
dplyr::group_by(era,
preOperative_infection_status) %>%
dplyr::summarise(n = n())
totals_OS_NC <-
expand.grid(
era =
c("Error: No surgery", "Pre-pandemic", "Pandemic no vaccine", "Pandemic with vaccine"),
"preOperative_infection_status" =
c("Error: Test result after surgery. Check study_definition.",
"No record of pre-operative SARS-CoV-2 infection",
"0-2 weeks record of pre-operative SARS-CoV-2 infection",
"3-4 weeks record of pre-operative SARS-CoV-2 infection",
"5-6 weeks record of pre-operative SARS-CoV-2 infection",
">=7 weeks record of pre-operative SARS-CoV-2 infection")) %>%
dplyr::full_join(totals_OS_NC) %>%
dplyr::arrange(era) %>%
tidyr::replace_na(list("n" = 0))
## ## # Pre-pandemic, OpenSAFELY data, no-cancer patients.
PP_OS_NC_totals <- totals_OS_NC %>%
dplyr::filter(era == "Pre-pandemic" &
preOperative_infection_status !=
"Error: Test result after surgery. Check study_definition.") %>%
dplyr::arrange(preOperative_infection_status) %>% select(n) %>% t() %>% data.frame()
PP_OS_NC_totals <- cbind(sum(PP_OS_NC_totals), PP_OS_NC_totals)
colnames(PP_OS_NC_totals) <- colnames(COVIDSurg_totals)
## ## # Pandemic no vaccines, OpenSAFELY data, no-cancer patients.
PNV_OS_NC_totals <- totals_OS_NC %>%
dplyr::filter(era == "Pandemic no vaccine" &
preOperative_infection_status !=
"Error: Test result after surgery. Check study_definition.") %>%
dplyr::arrange(preOperative_infection_status) %>% select(n) %>% t() %>% data.frame()
PNV_OS_NC_totals <- cbind(sum(PNV_OS_NC_totals), PNV_OS_NC_totals)
colnames(PNV_OS_NC_totals) <- colnames(COVIDSurg_totals)
## ## # Pandemic with vaccines, OpenSAFELY data, no-cancer patients.
PWV_OS_NC_totals <- totals_OS_NC %>%
dplyr::filter(era == "Pandemic with vaccine" &
preOperative_infection_status !=
"Error: Test result after surgery. Check study_definition.") %>%
dplyr::arrange(preOperative_infection_status) %>% select(n) %>% t() %>% data.frame()
PWV_OS_NC_totals <- cbind(sum(PWV_OS_NC_totals), PWV_OS_NC_totals)
colnames(PWV_OS_NC_totals) <- colnames(COVIDSurg_totals)
# ----
## #  OpenSAFELY data, cancer patients. ----
totals_OS_C <-
myData_OS_C %>%
dplyr::group_by(era,
preOperative_infection_status) %>%
dplyr::summarise(n = n())
totals_OS_C <-
expand.grid(
era =
c("Error: No surgery", "Pre-pandemic", "Pandemic no vaccine", "Pandemic with vaccine"),
"preOperative_infection_status" =
c("Error: Test result after surgery. Check study_definition.",
"No record of pre-operative SARS-CoV-2 infection",
"0-2 weeks record of pre-operative SARS-CoV-2 infection",
"3-4 weeks record of pre-operative SARS-CoV-2 infection",
"5-6 weeks record of pre-operative SARS-CoV-2 infection",
">=7 weeks record of pre-operative SARS-CoV-2 infection")) %>%
dplyr::full_join(totals_OS_C) %>%
dplyr::arrange(era) %>%
tidyr::replace_na(list("n" = 0))
## ## # Pre-pandemic, OpenSAFELY data, no-cancer patients.
PP_OS_C_totals <- totals_OS_C %>%
dplyr::filter(era == "Pre-pandemic" &
preOperative_infection_status !=
"Error: Test result after surgery. Check study_definition.") %>%
dplyr::arrange(preOperative_infection_status) %>% select(n) %>% t() %>% data.frame()
PP_OS_C_totals <- cbind(sum(PP_OS_C_totals), PP_OS_C_totals)
colnames(PP_OS_C_totals) <- colnames(COVIDSurg_totals)
## ## # Pandemic no vaccines, OpenSAFELY data, no-cancer patients.
PNV_OS_C_totals <- totals_OS_C %>%
dplyr::filter(era == "Pandemic no vaccine" &
preOperative_infection_status !=
"Error: Test result after surgery. Check study_definition.") %>%
dplyr::arrange(preOperative_infection_status) %>% select(n) %>% t() %>% data.frame()
PNV_OS_C_totals <- cbind(sum(PNV_OS_C_totals), PNV_OS_C_totals)
colnames(PNV_OS_C_totals) <- colnames(COVIDSurg_totals)
## ## # Pandemic with vaccines, OpenSAFELY data, no-cancer patients.
PWV_OS_C_totals <- totals_OS_C %>%
dplyr::filter(era == "Pandemic with vaccine" &
preOperative_infection_status !=
"Error: Test result after surgery. Check study_definition.") %>%
dplyr::arrange(preOperative_infection_status) %>% select(n) %>% t() %>% data.frame()
PWV_OS_C_totals <- cbind(sum(PWV_OS_C_totals), PWV_OS_C_totals)
colnames(PWV_OS_C_totals) <- colnames(COVIDSurg_totals)
# ----
totals_OS_NC
##################################################################
## Counts of 30-day post-operative mortality, across intervals. ##
##################################################################
# ## Count of patients in each of the categories for pre-operative infection
# ## status (stratified by surgery era; see above) also stratified by whether
# ## or not the patient died within 30 days of their surgery:
# ##    1. "Alive within 30-day post-operation"
# ##    2. "Dead within 30-day post-operation"
#
## # OpenSAFELY data, no-cancer patients. ----
myData_OS_NC %>% dplyr::group_by(era, postOp_mortality_30day) %>%
dplyr::summarise(n_per_group = sum(ifelse(preOperative_infection_status!=
"Error: Test result after surgery. Check study_definition.",1,0)),
n_infection_none = sum(ifelse(preOperative_infection_status==
"No record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_0to2wk = sum(ifelse(preOperative_infection_status==
"0-2 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_3to4wk = sum(ifelse(preOperative_infection_status==
"3-4 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_5to6wk = sum(ifelse(preOperative_infection_status==
"5-6 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_7wk = sum(ifelse(preOperative_infection_status==
">=7 weeks record of pre-operative SARS-CoV-2 infection",1,0))
)
expand.grid(
era =
c("No surgery", "preCOVID surgery", "postCOVID surgery"),
postOp_mortality_30day =
c("Alive within 30-day post-operation",
"Dead within 30-day post-operation",
"Error: Surgery after death",
"No death recorded",
"No surgery recorded",
"Missing")) %>%
dplyr::full_join(table1_postOp_mortality_30day) %>%
dplyr::arrange(era) %>%
tidyr::replace_na(list("n_per_group" = 0,
"n_infection_none" = 0,
"n_infection_0to2wk" = 0,
"n_infection_3to4wk" = 0,
"n_infection_5to6wk" = 0,
"n_infection_7wk" = 0))
##################################################################
## Counts of 30-day post-operative mortality, across intervals. ##
##################################################################
# ## Count of patients in each of the categories for pre-operative infection
# ## status (stratified by surgery era; see above) also stratified by whether
# ## or not the patient died within 30 days of their surgery:
# ##    1. "Alive within 30-day post-operation"
# ##    2. "Dead within 30-day post-operation"
#
## # OpenSAFELY data, no-cancer patients. ----
values_OS_C <-
myData_OS_NC %>% dplyr::group_by(era, postOp_mortality_30day) %>%
dplyr::summarise(n_per_group = sum(ifelse(preOperative_infection_status!=
"Error: Test result after surgery. Check study_definition.",1,0)),
n_infection_none = sum(ifelse(preOperative_infection_status==
"No record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_0to2wk = sum(ifelse(preOperative_infection_status==
"0-2 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_3to4wk = sum(ifelse(preOperative_infection_status==
"3-4 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_5to6wk = sum(ifelse(preOperative_infection_status==
"5-6 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_7wk = sum(ifelse(preOperative_infection_status==
">=7 weeks record of pre-operative SARS-CoV-2 infection",1,0))
)
expand.grid(
era =
c("Error: No surgery", "Pre-pandemic", "Pandemic no vaccine", "Pandemic with vaccine"),
postOp_mortality_30day =
c("Alive within 30-day post-operation",
"Dead within 30-day post-operation",
"Error: Surgery after death",
"No death recorded",
"No surgery recorded",
"Missing")) %>%
dplyr::full_join(values_OS_C) %>%
dplyr::arrange(era) %>%
tidyr::replace_na(list("n_per_group" = 0,
"n_infection_none" = 0,
"n_infection_0to2wk" = 0,
"n_infection_3to4wk" = 0,
"n_infection_5to6wk" = 0,
"n_infection_7wk" = 0))
values_OS_C <-
expand.grid(
era =
c("Error: No surgery", "Pre-pandemic", "Pandemic no vaccine", "Pandemic with vaccine"),
postOp_mortality_30day =
c("Alive within 30-day post-operation",
"Dead within 30-day post-operation",
"Error: Surgery after death",
"No death recorded",
"No surgery recorded",
"Missing")) %>%
dplyr::full_join(values_OS_C) %>%
dplyr::arrange(era) %>%
tidyr::replace_na(list("n_per_group" = 0,
"n_infection_none" = 0,
"n_infection_0to2wk" = 0,
"n_infection_3to4wk" = 0,
"n_infection_5to6wk" = 0,
"n_infection_7wk" = 0))
##################################################################
## Counts of 30-day post-operative mortality, across intervals. ##
##################################################################
# ## Count of patients in each of the categories for pre-operative infection
# ## status (stratified by surgery era; see above) also stratified by whether
# ## or not the patient died within 30 days of their surgery:
# ##    1. "Alive within 30-day post-operation"
# ##    2. "Dead within 30-day post-operation"
#
## # OpenSAFELY data, no-cancer patients. ----
values_OS_NC <-
myData_OS_NC %>% dplyr::group_by(era, postOp_mortality_30day) %>%
dplyr::summarise(n_per_group = sum(ifelse(preOperative_infection_status!=
"Error: Test result after surgery. Check study_definition.",1,0)),
n_infection_none = sum(ifelse(preOperative_infection_status==
"No record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_0to2wk = sum(ifelse(preOperative_infection_status==
"0-2 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_3to4wk = sum(ifelse(preOperative_infection_status==
"3-4 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_5to6wk = sum(ifelse(preOperative_infection_status==
"5-6 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_7wk = sum(ifelse(preOperative_infection_status==
">=7 weeks record of pre-operative SARS-CoV-2 infection",1,0))
)
values_OS_NC <-
expand.grid(
era =
c("Error: No surgery", "Pre-pandemic", "Pandemic no vaccine", "Pandemic with vaccine"),
postOp_mortality_30day =
c("Alive within 30-day post-operation",
"Dead within 30-day post-operation",
"Error: Surgery after death",
"No death recorded",
"No surgery recorded",
"Missing")) %>%
dplyr::full_join(values_OS_C) %>%
dplyr::arrange(era) %>%
tidyr::replace_na(list("n_per_group" = 0,
"n_infection_none" = 0,
"n_infection_0to2wk" = 0,
"n_infection_3to4wk" = 0,
"n_infection_5to6wk" = 0,
"n_infection_7wk" = 0))
values_OS_NC %>%
dplyr::filter(era == "Pre-pandemic" &
(postOp_mortality_30day=="Alive within 30-day post-operation"|
postOp_mortality_30day=="Dead within 30-day post-operation"|
postOp_mortality_30day=="Missing"))
values_OS_NC %>%
dplyr::filter(era == "Pre-pandemic" &
(postOp_mortality_30day=="Alive within 30-day post-operation"|
postOp_mortality_30day=="Dead within 30-day post-operation")) %>%
dplyr::arrange(postOp_mortality_30day)
values_OS_NC %>%
dplyr::filter(era == "Pre-pandemic" &
(postOp_mortality_30day=="Alive within 30-day post-operation"|
postOp_mortality_30day=="Dead within 30-day post-operation")) %>%
dplyr::arrange(postOp_mortality_30day) %>% dplyr::ungroup()
values_OS_NC %>%
dplyr::filter(era == "Pre-pandemic" &
postOp_mortality_30day=="Alive within 30-day post-operation") %>%
select(-n_per_group)
values_OS_NC %>%
dplyr::filter(era == "Pre-pandemic" &
postOp_mortality_30day=="Alive within 30-day post-operation") %>%
select(-c(era, postOp_mortality_30day, n_per_group))
# Counts of 30-day post-operative mortality, across intervals.
intervals_PP_OS_NC_values <- data.frame(
n_no_infection = NA,
pct_no_infection = NA,
n_infection_0to2wk = NA,
pct_infection_0to2wk = NA,
n_infection_3to4wk = NA,
pct_infection_3to4wk = NA,
n_infection_5to6wk = NA,
pct_infection_5to6wk = NA,
n_infection_7wk = NA,
pct_infection_7wk = NA
)
intervals_PP_OS_NC_values[seq(110,2)] <- PP_OS_NC_values
## ## # Pre-pandemic, OpenSAFELY data, no-cancer patients.
PP_OS_NC_values <- values_OS_NC %>%
dplyr::filter(era == "Pre-pandemic" &
postOp_mortality_30day=="Alive within 30-day post-operation") %>%
select(-c(era, postOp_mortality_30day, n_per_group))
# Counts of 30-day post-operative mortality, across intervals.
intervals_PP_OS_NC_values <- data.frame(
n_no_infection = NA,
pct_no_infection = NA,
n_infection_0to2wk = NA,
pct_infection_0to2wk = NA,
n_infection_3to4wk = NA,
pct_infection_3to4wk = NA,
n_infection_5to6wk = NA,
pct_infection_5to6wk = NA,
n_infection_7wk = NA,
pct_infection_7wk = NA
)
# Counts of 30-day post-operative mortality, across intervals.
intervals_PP_OS_NC_values <- data.frame(
n_no_infection = numeric(),
pct_no_infection = numeric(),
n_infection_0to2wk = numeric(),
pct_infection_0to2wk = numeric(),
n_infection_3to4wk = numeric(),
pct_infection_3to4wk = numeric(),
n_infection_5to6wk = numeric(),
pct_infection_5to6wk = numeric(),
n_infection_7wk = numeric(),
pct_infection_7wk = numeric()
)
intervals_PP_OS_NC_values[seq(110,2)] <- PP_OS_NC_values
PP_OS_NC_values
intervals_PP_OS_NC_values[seq(110,2)] <- PP_OS_NC_values[[]]
intervals_PP_OS_NC_values[seq(110,2)] <- PP_OS_NC_values[[:]]
## ## # Pre-pandemic, OpenSAFELY data, no-cancer patients.
PP_OS_NC_values <- values_OS_NC %>%
dplyr::filter(era == "Pre-pandemic" &
postOp_mortality_30day=="Alive within 30-day post-operation") %>%
select(-c(era, postOp_mortality_30day, n_per_group)) %>% dplyr::ungroup()
# Counts of 30-day post-operative mortality, across intervals.
intervals_PP_OS_NC_values <- data.frame(
n_no_infection = numeric(),
pct_no_infection = numeric(),
n_infection_0to2wk = numeric(),
pct_infection_0to2wk = numeric(),
n_infection_3to4wk = numeric(),
pct_infection_3to4wk = numeric(),
n_infection_5to6wk = numeric(),
pct_infection_5to6wk = numeric(),
n_infection_7wk = numeric(),
pct_infection_7wk = numeric()
)
PP_OS_NC_values
intervals_PP_OS_NC_values[seq(1,10,2)] <- PP_OS_NC_values
as.matrix(PP_OS_NC_values)
as.numeric(PP_OS_NC_values)
intervals_PP_OS_NC_values[seq(1,10,2)] <- as.numeric(PP_OS_NC_values)
seq(1,10,2)
## ## # Pre-pandemic, OpenSAFELY data, no-cancer patients.
PP_OS_NC_values <- values_OS_NC %>%
dplyr::filter(era == "Pre-pandemic" &
postOp_mortality_30day=="Alive within 30-day post-operation") %>%
select(-c(era, postOp_mortality_30day, n_per_group)) %>% dplyr::ungroup()
source("C:/Users/medcmci/OneDrive - University of Leeds/PSTRC/OpenSAFELY/OS technical stuff/GIT/surg-covid-safely/analysis/Make_table_COVIDSurg_compare.R", echo=TRUE)
PP_OS_NC_values
# Counts of 30-day post-operative mortality, across intervals.
intervals_PP_OS_NC_values <- data.frame(
n_infection_none = numeric(),
pct_no_infection = numeric(),
n_infection_0to2wk = numeric(),
pct_infection_0to2wk = numeric(),
n_infection_3to4wk = numeric(),
pct_infection_3to4wk = numeric(),
n_infection_5to6wk = numeric(),
pct_infection_5to6wk = numeric(),
n_infection_7wk = numeric(),
pct_infection_7wk = numeric()
)
intervals_PP_OS_NC_values[seq(1,10,2)]
intervals_PP_OS_NC_values[seq(1,10,2)] <- PP_OS_NC_values
# Counts of 30-day post-operative mortality, across intervals.
intervals_PP_OS_NC_values <- data.frame(
n_infection_none = 0,
pct_no_infection = 0,
n_infection_0to2wk = 0,
pct_infection_0to2wk = 0,
n_infection_3to4wk = 0,
pct_infection_3to4wk = 0,
n_infection_5to6wk = 0,
pct_infection_5to6wk = 0,
n_infection_7wk = 0,
pct_infection_7wk = 0
)
intervals_PP_OS_NC_values[seq(1,10,2)] <- PP_OS_NC_values
# Percentages of 30-day post-operative mortality, across intervals.
intervals_PP_OS_NC_values[seq(2,10,2)] <-
(intervals_PP_OS_NC_values[seq(1,10,2)] /
PP_OS_NC_totals[2:ncol(PP_OS_NC_totals)]) * 100
## ## # Pandemic no vaccines, OpenSAFELY data, no-cancer patients.
PNV_OS_NC_values <- values_OS_NC %>%
dplyr::filter(era == "Pre-pandemic" &
postOp_mortality_30day=="Alive within 30-day post-operation") %>%
select(-c(era, postOp_mortality_30day, n_per_group)) %>% dplyr::ungroup()
# Counts of 30-day post-operative mortality, across intervals.
intervals_PNV_OS_NC_values <- data.frame(
n_infection_none = 0,
pct_no_infection = 0,
n_infection_0to2wk = 0,
pct_infection_0to2wk = 0,
n_infection_3to4wk = 0,
pct_infection_3to4wk = 0,
n_infection_5to6wk = 0,
pct_infection_5to6wk = 0,
n_infection_7wk = 0,
pct_infection_7wk = 0
)
intervals_PNV_OS_NC_values[seq(1,10,2)] <- PNV_OS_NC_values
# Percentages of 30-day post-operative mortality, across intervals.
intervals_PNV_OS_NC_values[seq(2,10,2)] <-
(intervals_PNV_OS_NC_values[seq(1,10,2)] /
PNV_OS_NC_totals[2:ncol(PNV_OS_NC_totals)]) * 100
