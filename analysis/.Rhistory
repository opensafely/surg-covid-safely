list("pct_total" = 0,
"pct_infection_none" = 0,
"pct_infection_0to2wk" = 0,
"pct_infection_3to4wk" = 0,
"pct_infection_5to6wk" = 0,
"pct_infection_7wk" = 0))
# ----
## ## # Pandemic with vaccines, OpenSAFELY data, no-cancer patients.----
PWV_OS_C_within3m_mortality <- OS_C_within3m_mortality %>%
dplyr::filter(era == "Pandemic with vaccine" &
postOp_mortality_30day=="Dead within 30 days post-operation") %>%
select(-c(era, postOp_mortality_30day)) %>% dplyr::ungroup()
## ## ## # Counts of 30-day post-operative mortality, across intervals.
PWV_OS_C_within3m_mortality_intervals <- data.frame(
d_total = 0,
pct_total = 0,
d_infection_none = 0,
pct_infection_none = 0,
d_infection_0to2wk = 0,
pct_infection_0to2wk = 0,
d_infection_3to4wk = 0,
pct_infection_3to4wk = 0,
d_infection_5to6wk = 0,
pct_infection_5to6wk = 0,
d_infection_7wk = 0,
pct_infection_7wk = 0
)
PWV_OS_C_within3m_mortality_intervals[seq(1,12,2)] <- PWV_OS_C_within3m_mortality
## ## ## # Percentages of 30-day post-operative mortality, across intervals.
PWV_OS_C_within3m_mortality_intervals[seq(2,12,2)] <-
(PWV_OS_C_within3m_mortality_intervals[seq(1,12,2)] / PWV_OS_C_within3m_counts) * 100
PWV_OS_C_within3m_mortality_intervals <-
tidyr::replace_na(PWV_OS_C_within3m_mortality_intervals,
list("pct_total" = 0,
"pct_infection_none" = 0,
"pct_infection_0to2wk" = 0,
"pct_infection_3to4wk" = 0,
"pct_infection_5to6wk" = 0,
"pct_infection_7wk" = 0))
# ----
##################################################################
## Counts of 30-day post-operative mortality, across intervals. ##
## OpenSAFELY data, cancer outwith 3 months patients.           ##
##################################################################
# ----
# Count of patients in each of the categories for pre-operative infection
# status (stratified by surgery era; see above) also stratified by whether
# or not the patient died outwith 30 days of their surgery:
#   1. "Alive outwith 30 days post-operation"
#   2. "Dead outwith 30 days post-operation"
#
## # OpenSAFELY data, cancer patients.
OS_C_outwith3m_mortality <-
data_to_use_C_outwith3m %>% dplyr::group_by(era, postOp_mortality_30day) %>%
dplyr::summarise(n_per_group = sum(ifelse(preOperative_infection_status!=
"Error: Test result after surgery. Check study_definition.",1,0)),
n_infection_none = sum(ifelse(preOperative_infection_status==
"No record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_0to2wk = sum(ifelse(preOperative_infection_status==
"0-2 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_3to4wk = sum(ifelse(preOperative_infection_status==
"3-4 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_5to6wk = sum(ifelse(preOperative_infection_status==
"5-6 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_7wk = sum(ifelse(preOperative_infection_status==
">=7 weeks record of pre-operative SARS-CoV-2 infection",1,0))
)
OS_CSP_C_outwith3m_mortality <-
data_to_use_C_outwith3m %>%
dplyr::filter(COVIDSurg_data_collection_period != "Error: No surgery") %>%
dplyr::group_by(COVIDSurg_data_collection_period, postOp_mortality_30day) %>%
dplyr::summarise(n_per_group = sum(ifelse(preOperative_infection_status!=
"Error: Test result after surgery. Check study_definition.",1,0)),
n_infection_none = sum(ifelse(preOperative_infection_status==
"No record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_0to2wk = sum(ifelse(preOperative_infection_status==
"0-2 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_3to4wk = sum(ifelse(preOperative_infection_status==
"3-4 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_5to6wk = sum(ifelse(preOperative_infection_status==
"5-6 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_7wk = sum(ifelse(preOperative_infection_status==
">=7 weeks record of pre-operative SARS-CoV-2 infection",1,0))
) %>%
`colnames<-`(c("era",colnames(OS_C_outwith3m_mortality)[2:ncol(OS_C_outwith3m_mortality)]))
OS_C_outwith3m_mortality <- dplyr::bind_rows(OS_C_outwith3m_mortality, OS_CSP_C_outwith3m_mortality)
rm(OS_CSP_C_outwith3m_mortality)
OS_C_outwith3m_mortality <-
expand.grid(
era =
c("Pre-pandemic", "Pandemic no vaccine",
"Pandemic with vaccine", "COVIDSurg data collection period",
"Not COVIDSurg data collection period"),
postOp_mortality_30day =
c("Alive outwith 30 days post-operation",
"Dead outwith 30 days post-operation",
"Error: Surgery after death",
"No death recorded",
"No surgery recorded",
"Missing")) %>%
dplyr::full_join(OS_C_outwith3m_mortality) %>%
dplyr::arrange(era) %>%
tidyr::replace_na(list("n_per_group" = 0,
"n_infection_none" = 0,
"n_infection_0to2wk" = 0,
"n_infection_3to4wk" = 0,
"n_infection_5to6wk" = 0,
"n_infection_7wk" = 0))
## ## # Pre-pandemic, OpenSAFELY data, no-cancer patients.----
PP_OS_C_outwith3m_mortality <- OS_C_outwith3m_mortality %>%
dplyr::filter(era == "Pre-pandemic" &
postOp_mortality_30day=="Dead outwith 30 days post-operation") %>%
select(-c(era, postOp_mortality_30day)) %>% dplyr::ungroup()
## ## ## # Counts of 30-day post-operative mortality, across intervals.
PP_OS_C_outwith3m_mortality_intervals <- data.frame(
d_total = 0,
pct_total = 0,
d_infection_none = NA,
pct_infection_none = NA,
d_infection_0to2wk = NA,
pct_infection_0to2wk = NA,
d_infection_3to4wk = NA,
pct_infection_3to4wk = NA,
d_infection_5to6wk = NA,
pct_infection_5to6wk = NA,
d_infection_7wk = NA,
pct_infection_7wk = NA
)
PP_OS_C_outwith3m_mortality_intervals['d_total'] <- PP_OS_C_outwith3m_mortality['n_per_group']
## ## ## # Percentages of 30-day post-operative mortality, across intervals.
PP_OS_C_outwith3m_mortality_intervals['pct_total'] <-
(PP_OS_C_outwith3m_mortality_intervals['d_total'] / PP_OS_C_outwith3m_counts['n_total']) * 100
PP_OS_C_outwith3m_mortality_intervals <-
tidyr::replace_na(PP_OS_C_outwith3m_mortality_intervals, list("pct_total" = 0))
# ----
## ## # Pandemic no vaccines, OpenSAFELY data, no-cancer patients.----
PNV_OS_C_outwith3m_mortality <- OS_C_outwith3m_mortality %>%
dplyr::filter(era == "Pandemic no vaccine" &
postOp_mortality_30day=="Dead outwith 30 days post-operation") %>%
select(-c(era, postOp_mortality_30day)) %>% dplyr::ungroup()
## ## ## # Counts of 30-day post-operative mortality, across intervals.
PNV_OS_C_outwith3m_mortality_intervals <- data.frame(
d_total = 0,
pct_total = 0,
d_infection_none = 0,
pct_infection_none = 0,
d_infection_0to2wk = 0,
pct_infection_0to2wk = 0,
d_infection_3to4wk = 0,
pct_infection_3to4wk = 0,
d_infection_5to6wk = 0,
pct_infection_5to6wk = 0,
d_infection_7wk = 0,
pct_infection_7wk = 0
)
PNV_OS_C_outwith3m_mortality_intervals[seq(1,12,2)] <- PNV_OS_C_outwith3m_mortality
## ## ## # Percentages of 30-day post-operative mortality, across intervals.
PNV_OS_C_outwith3m_mortality_intervals[seq(2,12,2)] <-
(PNV_OS_C_outwith3m_mortality_intervals[seq(1,12,2)] / PNV_OS_C_outwith3m_counts) * 100
PNV_OS_C_outwith3m_mortality_intervals <-
tidyr::replace_na(PNV_OS_C_outwith3m_mortality_intervals,
list("pct_total" = 0,
"pct_infection_none" = 0,
"pct_infection_0to2wk" = 0,
"pct_infection_3to4wk" = 0,
"pct_infection_5to6wk" = 0,
"pct_infection_7wk" = 0))
# ----
## ## # COVIDSurg data collection period, OpenSAFELY data, no-cancer patients.----
CSP_OS_C_outwith3m_mortality <- OS_C_outwith3m_mortality %>%
dplyr::filter(era == "COVIDSurg data collection period" &
postOp_mortality_30day=="Dead outwith 30 days post-operation") %>%
select(-c(era, postOp_mortality_30day)) %>% dplyr::ungroup()
## ## ## # Counts of 30-day post-operative mortality, across intervals.
CSP_OS_C_outwith3m_mortality_intervals <- data.frame(
d_total = 0,
pct_total = 0,
d_infection_none = 0,
pct_infection_none = 0,
d_infection_0to2wk = 0,
pct_infection_0to2wk = 0,
d_infection_3to4wk = 0,
pct_infection_3to4wk = 0,
d_infection_5to6wk = 0,
pct_infection_5to6wk = 0,
d_infection_7wk = 0,
pct_infection_7wk = 0
)
CSP_OS_C_outwith3m_mortality_intervals[seq(1,12,2)] <- CSP_OS_C_outwith3m_mortality
## ## ## # Percentages of 30-day post-operative mortality, across intervals.
CSP_OS_C_outwith3m_mortality_intervals[seq(2,12,2)] <-
(CSP_OS_C_outwith3m_mortality_intervals[seq(1,12,2)] / CSP_OS_C_outwith3m_counts) * 100
CSP_OS_C_outwith3m_mortality_intervals <-
tidyr::replace_na(CSP_OS_C_outwith3m_mortality_intervals,
list("pct_total" = 0,
"pct_infection_none" = 0,
"pct_infection_0to2wk" = 0,
"pct_infection_3to4wk" = 0,
"pct_infection_5to6wk" = 0,
"pct_infection_7wk" = 0))
# ----
## ## # Pandemic with vaccines, OpenSAFELY data, no-cancer patients.----
PWV_OS_C_outwith3m_mortality <- OS_C_outwith3m_mortality %>%
dplyr::filter(era == "Pandemic with vaccine" &
postOp_mortality_30day=="Dead outwith 30 days post-operation") %>%
select(-c(era, postOp_mortality_30day)) %>% dplyr::ungroup()
## ## ## # Counts of 30-day post-operative mortality, across intervals.
PWV_OS_C_outwith3m_mortality_intervals <- data.frame(
d_total = 0,
pct_total = 0,
d_infection_none = 0,
pct_infection_none = 0,
d_infection_0to2wk = 0,
pct_infection_0to2wk = 0,
d_infection_3to4wk = 0,
pct_infection_3to4wk = 0,
d_infection_5to6wk = 0,
pct_infection_5to6wk = 0,
d_infection_7wk = 0,
pct_infection_7wk = 0
)
PWV_OS_C_outwith3m_mortality_intervals[seq(1,12,2)] <- PWV_OS_C_outwith3m_mortality
## ## ## # Percentages of 30-day post-operative mortality, across intervals.
PWV_OS_C_outwith3m_mortality_intervals[seq(2,12,2)] <-
(PWV_OS_C_outwith3m_mortality_intervals[seq(1,12,2)] / PWV_OS_C_outwith3m_counts) * 100
PWV_OS_C_outwith3m_mortality_intervals <-
tidyr::replace_na(PWV_OS_C_outwith3m_mortality_intervals,
list("pct_total" = 0,
"pct_infection_none" = 0,
"pct_infection_0to2wk" = 0,
"pct_infection_3to4wk" = 0,
"pct_infection_5to6wk" = 0,
"pct_infection_7wk" = 0))
# ----
#############################################################
## Counts of 30-day post-operative mortality, in each era. ##
#############################################################
# ----
# OpenSAFELY data, no-cancer patients.
OS_all_mortality_totals <- data.frame(
d_PP = PP_OS_all_mortality_intervals[['d_total']],
pct_PP = PP_OS_all_mortality_intervals[['pct_total']],
d_PNV = PNV_OS_all_mortality_intervals[['d_total']],
pct_PNV = PNV_OS_all_mortality_intervals[['pct_total']],
d_CSP = CSP_OS_all_mortality_intervals[['d_total']],
pct_CSP = CSP_OS_all_mortality_intervals[['pct_total']],
d_PWV = PWV_OS_all_mortality_intervals[['d_total']],
pct_PWV = PWV_OS_all_mortality_intervals[['pct_total']]
)
# OpenSAFELY data, no-cancer patients.
OS_NC_mortality_totals <- data.frame(
d_PP = PP_OS_NC_mortality_intervals[['d_total']],
pct_PP = PP_OS_NC_mortality_intervals[['pct_total']],
d_PNV = PNV_OS_NC_mortality_intervals[['d_total']],
pct_PNV = PNV_OS_NC_mortality_intervals[['pct_total']],
d_CSP = CSP_OS_NC_mortality_intervals[['d_total']],
pct_CSP = CSP_OS_NC_mortality_intervals[['pct_total']],
d_PWV = PWV_OS_NC_mortality_intervals[['d_total']],
pct_PWV = PWV_OS_NC_mortality_intervals[['pct_total']]
)
# OpenSAFELY data, cancer within 3 months patients.
OS_C_within3m_mortality_totals <- data.frame(
d_PP = PP_OS_C_within3m_mortality_intervals[['d_total']],
pct_PP = PP_OS_C_within3m_mortality_intervals[['pct_total']],
d_PNV = PNV_OS_C_within3m_mortality_intervals[['d_total']],
pct_PNV = PNV_OS_C_within3m_mortality_intervals[['pct_total']],
d_CSP = CSP_OS_C_within3m_mortality_intervals[['d_total']],
pct_CSP = CSP_OS_C_within3m_mortality_intervals[['pct_total']],
d_PWV = PWV_OS_C_within3m_mortality_intervals[['d_total']],
pct_PWV = PWV_OS_C_within3m_mortality_intervals[['pct_total']]
)
# OpenSAFELY data, cancer outwith 3 months patients.
OS_C_outwith3m_mortality_totals <- data.frame(
d_PP = PP_OS_C_outwith3m_mortality_intervals[['d_total']],
pct_PP = PP_OS_C_outwith3m_mortality_intervals[['pct_total']],
d_PNV = PNV_OS_C_outwith3m_mortality_intervals[['d_total']],
pct_PNV = PNV_OS_C_outwith3m_mortality_intervals[['pct_total']],
d_CSP = CSP_OS_C_outwith3m_mortality_intervals[['d_total']],
pct_CSP = CSP_OS_C_outwith3m_mortality_intervals[['pct_total']],
d_PWV = PWV_OS_C_outwith3m_mortality_intervals[['d_total']],
pct_PWV = PWV_OS_C_outwith3m_mortality_intervals[['pct_total']]
)
# ----
#############################
## Construct counts table. ##
#############################
# ----
table_counts <-
rbind(
rep(NA, 6),               # Pre-pandemic, COVIDSurg.
PP_OS_all_counts,         # Pre-pandemic, OpenSAFELY data, all surgery patients.
PP_OS_NC_counts,          # Pre-pandemic, OpenSAFELY data, no-cancer patients.
PP_OS_C_within3m_counts,  # Pre-pandemic, OpenSAFELY data, cancer within 3 months patients.
PP_OS_C_outwith3m_counts, # Pre-pandemic, OpenSAFELY data, cancer outwith 3 months patients.
rep(NA, 6),               # Pandemic no vaccines, COVIDSurg.
PNV_OS_all_counts,        # Pandemic no vaccines, OpenSAFELY data, all surgery patients.
PNV_OS_NC_counts,         # Pandemic no vaccines, OpenSAFELY data, no-cancer patients.
PNV_OS_C_within3m_counts, # Pandemic no vaccines, OpenSAFELY data, cancer within 3 months patients.
PNV_OS_C_outwith3m_counts,# Pandemic no vaccines, OpenSAFELY data, cancer outwith 3 months patients.
COVIDSurg_counts,         # COVIDSurg data collection period, COVIDSurg.
CSP_OS_all_counts,         # COVIDSurg data collection period, OpenSAFELY data, all surgery patients.
CSP_OS_NC_counts,         # COVIDSurg data collection period, OpenSAFELY data, no-cancer patients.
CSP_OS_C_within3m_counts, # COVIDSurg data collection period, OpenSAFELY data, cancer within 3 months patients.
CSP_OS_C_outwith3m_counts,# COVIDSurg data collection period, OpenSAFELY data, cancer outwith 3 months patients.
rep(NA, 6),               # Pandemic with vaccines, COVIDSurg.
PWV_OS_all_counts,         # Pandemic with vaccines, OpenSAFELY data, all surgery patients.
PWV_OS_NC_counts,         # Pandemic with vaccines, OpenSAFELY data, no-cancer patients.
PWV_OS_C_within3m_counts, # Pandemic with vaccines, OpenSAFELY data, cancer within 3 months patients.
PWV_OS_C_outwith3m_counts # Pandemic with vaccines, OpenSAFELY data, cancer outwith 3 months patients.
) %>% data.frame()
rownames(table_counts) <-
c(
"PP_COVIDSurg",
"PP_OS_all",
"PP_OS_NC",
"PP_OS_C_within3m",
"PP_OS_C_outwith3m",
"PNV_COVIDSurg",
"PNV_OS_all",
"PNV_OS_NC",
"PNV_OS_C_within3m",
"PNV_OS_C_outwith3m",
"CSP_COVIDSurg",
"CSP_OS_all",
"CSP_OS_NC",
"CSP_OS_C_within3m",
"CSP_OS_C_outwith3m",
"PWV_COVIDSurg",
"PWV_OS_all",
"PWV_OS_NC",
"PWV_OS_C_within3m",
"PWV_OS_C_outwith3m"
)
# Save table.
write.csv(
x = table_counts,
file = here::here("output",
"table_Count_of_patients_in_each_cohort_in_each_era_across_all_intervals.csv")
)
# Make table with only 7week threshold.
intervals_less_than_7wks <- c("n_infection_0to2wk", "n_infection_3to4wk",
"n_infection_5to6wk")
table_counts_7wkThreshold <-
table_counts %>% dplyr::select(tidyselect::all_of(intervals_less_than_7wks)) %>% data.matrix() %>%
rowSums() %>% as.data.frame() %>%
tibble::add_column(table_counts %>% dplyr::select(n_total, n_infection_none),
.before = ".") %>%
tibble::add_column(table_counts %>%
dplyr::select(n_infection_7wk)) %>%
`colnames<-`(c("n_total", "n_infection_none", "n_infection_<7wks", "n_infection_>7wks"))
# Save table.
write.csv(
x = table_counts_7wkThreshold,
file = here::here("output",
"table_7wkThreshold_Count_of_patients_in_each_cohort_in_each_era_across_all_intervals.csv")
)
# ----
#################################################
## Construct mortality-across-intervals table. ##
#################################################
# ----
table_mortality_intervals <-
rbind(
rep(NA, 12),                             # Pandemic no vaccines, COVIDSurg.
PNV_OS_all_mortality_intervals,           # Pandemic no vaccines, OpenSAFELY data, all surgery patients.
PNV_OS_NC_mortality_intervals,           # Pandemic no vaccines, OpenSAFELY data, no-cancer patients.
PNV_OS_C_within3m_mortality_intervals,   # Pandemic no vaccines, OpenSAFELY data, cancer within 3 months patients.
PNV_OS_C_outwith3m_mortality_intervals,  # Pandemic no vaccines, OpenSAFELY data, cancer outwith 3 months patients.
COVIDSurg_mortality_intervals,           # COVIDSurg data collection period, COVIDSurg.
CSP_OS_all_mortality_intervals,           # COVIDSurg data collection period, OpenSAFELY data, all surgery patients.
CSP_OS_NC_mortality_intervals,           # COVIDSurg data collection period, OpenSAFELY data, no-cancer patients.
CSP_OS_C_within3m_mortality_intervals,   # COVIDSurg data collection period, OpenSAFELY data, cancer within 3 months patients.
CSP_OS_C_outwith3m_mortality_intervals,  # COVIDSurg data collection period, OpenSAFELY data, cancer outwith 3 months patients.
rep(NA, 12),                             # Pandemic with vaccines, COVIDSurg.
PWV_OS_all_mortality_intervals,           # Pandemic with vaccines, OpenSAFELY data, all surgery patients.
PWV_OS_NC_mortality_intervals,           # Pandemic with vaccines, OpenSAFELY data, no-cancer patients.
PWV_OS_C_within3m_mortality_intervals,   # Pandemic with vaccines, OpenSAFELY data, cancer within 3 months patients.
PWV_OS_C_outwith3m_mortality_intervals   # Pandemic with vaccines, OpenSAFELY data, cancer outwith 3 months patients.
)
rownames(table_mortality_intervals) <-
c(
"PNV_COVIDSurg",
"PNV_OS_all",
"PNV_OS_NC",
"PNV_OS_C_within3m",
"PNV_OS_C_outwith3m",
"CSP_COVIDSurg",
"CSP_OS_all",
"CSP_OS_NC",
"CSP_OS_C_within3m",
"CSP_OS_C_outwith3m",
"PWV_COVIDSurg",
"PWV_OS_all",
"PWV_OS_NC",
"PWV_OS_C_within3m",
"PWV_OS_C_outwith3m"
)
View(table_mortality_intervals)
CSP_OS_all_mortality_intervals
CSP_OS_NC_mortality_intervals
CSP_OS_C_within3m_mortality_intervals
## ## ## # Counts of 30-day post-operative mortality, across intervals.
CSP_OS_NC_mortality_intervals <- data.frame(
d_total = 0,
pct_total = 0,
d_infection_none = 0,
pct_infection_none = 0,
d_infection_0to2wk = 0,
pct_infection_0to2wk = 0,
d_infection_3to4wk = 0,
pct_infection_3to4wk = 0,
d_infection_5to6wk = 0,
pct_infection_5to6wk = 0,
d_infection_7wk = 0,
pct_infection_7wk = 0
)
CSP_OS_NC_mortality
CSP_OS_NC_counts
CSP_OS_NC_mortality_intervals[seq(1,12,2)]
## ## ## # Counts of 30-day post-operative mortality, across intervals.
CSP_OS_NC_mortality_intervals <- data.frame(
d_total = 0,
pct_total = 0,
d_infection_none = 0,
pct_infection_none = 0,
d_infection_0to2wk = 0,
pct_infection_0to2wk = 0,
d_infection_3to4wk = 0,
pct_infection_3to4wk = 0,
d_infection_5to6wk = 0,
pct_infection_5to6wk = 0,
d_infection_7wk = 0,
pct_infection_7wk = 0
)
CSP_OS_NC_mortality_intervals
CSP_OS_NC_mortality_intervals[seq(1,12,2)] <- CSP_OS_NC_mortality
CSP_OS_NC_mortality_intervals[seq(1,12,2)]
CSP_OS_NC_mortality_intervals[seq(1,12,2)] / CSP_OS_NC_counts
## ## ## # Percentages of 30-day post-operative mortality, across intervals.
CSP_OS_NC_mortality_intervals[seq(2,12,2)] <-
(CSP_OS_NC_mortality_intervals[seq(1,12,2)] / CSP_OS_NC_counts) * 100
CSP_OS_NC_mortality_intervals
CSP_OS_C_within3m_mortality
CSP_OS_C_within3m_mortality_intervals
OS_C_within3m_mortality
OS_C_within3m_mortality %>%
dplyr::filter(era == "COVIDSurg data collection period" &
postOp_mortality_30day=="Dead within 30 days post-operation")
OS_CSP_C_within3m_mortality <-
data_to_use_C_within3m %>%
dplyr::filter(COVIDSurg_data_collection_period != "Error: No surgery") %>%
dplyr::group_by(COVIDSurg_data_collection_period, postOp_mortality_30day) %>%
dplyr::summarise(n_per_group = sum(ifelse(preOperative_infection_status!=
"Error: Test result after surgery. Check study_definition.",1,0)),
n_infection_none = sum(ifelse(preOperative_infection_status==
"No record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_0to2wk = sum(ifelse(preOperative_infection_status==
"0-2 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_3to4wk = sum(ifelse(preOperative_infection_status==
"3-4 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_5to6wk = sum(ifelse(preOperative_infection_status==
"5-6 weeks record of pre-operative SARS-CoV-2 infection",1,0)),
n_infection_7wk = sum(ifelse(preOperative_infection_status==
">=7 weeks record of pre-operative SARS-CoV-2 infection",1,0))
) %>%
`colnames<-`(c("era",colnames(OS_C_within3m_mortality)[2:ncol(OS_C_within3m_mortality)]))
OS_CSP_C_within3m_mortality
write.csv(
x = TableEra,
file = here::here("output", "TableEra.csv")
)
# Combine both cancer groups.
PNV_OS_C <-
table_mortality_intervals[c("PNV_OS_C_within3m", "PNV_OS_C_outwith3m"),] %>%
colSums()
PNV_OS_C[seq(2, ncol(table_mortality_intervals), 2)] <-
PNV_OS_C[seq(1, ncol(table_mortality_intervals), 2)] /
colSums(rbind(PNV_OS_C_within3m_counts, PNV_OS_C_outwith3m_counts)) * 100
CSP_OS_C <-
table_mortality_intervals[c("CSP_OS_C_within3m", "CSP_OS_C_outwith3m"),] %>%
colSums()
CSP_OS_C[seq(2, ncol(table_mortality_intervals), 2)] <-
CSP_OS_C[seq(1, ncol(table_mortality_intervals), 2)] /
colSums(rbind(CSP_OS_C_within3m_counts, CSP_OS_C_outwith3m_counts)) * 100
PWV_OS_C <-
table_mortality_intervals[c("PWV_OS_C_within3m", "PWV_OS_C_outwith3m"),] %>%
colSums()
PWV_OS_C[seq(2, ncol(table_mortality_intervals), 2)] <-
PWV_OS_C[seq(1, ncol(table_mortality_intervals), 2)] /
colSums(rbind(PWV_OS_C_within3m_counts, PWV_OS_C_outwith3m_counts)) * 100
# Make table.
TableEra <-
rbind(
table_mortality_intervals[c("PNV_OS_all", "PNV_OS_NC"),],
PNV_OS_C = PNV_OS_C,
table_mortality_intervals[c("CSP_COVIDSurg","CSP_OS_all", "CSP_OS_NC"),],
CSP_OS_C = CSP_OS_C,
table_mortality_intervals[c("PWV_OS_all", "PWV_OS_NC"),],
PWV_OS_C = PWV_OS_C
) %>%
dplyr::mutate(dplyr::across(, ~ ifelse(is.nan(.),NA,.))) %>%
tidyr::replace_na(list("pct_total" = 0,
"pct_all_intervals" = 0,
"pct_infection_none" = 0,
"pct_infection_0to2wk" = 0,
"pct_infection_3to4wk" = 0,
"pct_infection_5to6wk" = 0,
"pct_infection_7wk" = 0)
)
table_mortality_intervals[c("CSP_OS_C_within3m", "CSP_OS_C_outwith3m"),] %>%
colSums()
rm(list =ls())
