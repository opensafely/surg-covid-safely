# ## table1_diabetes.
table1_diabetes <-
expand.grid(
era = era_set,
diabetes =
c("Yes",
"No",
"Missing")) %>%
dplyr::full_join(table1_diabetes %>% tidyr::replace_na(na_replace_list_temp)) %>%
dplyr::arrange(era) %>%
replace(is.na(.), 0) %>%
replace(. == na_replace_list_temp[[1]], NA)
# ## table1_chronic_respiratory_disease.
table1_chronic_respiratory_disease <-
expand.grid(
era = era_set,
chronic_respiratory_disease =
c("Yes",
"No",
"Missing")) %>%
dplyr::full_join(table1_chronic_respiratory_disease %>% tidyr::replace_na(na_replace_list_temp)) %>%
dplyr::arrange(era) %>%
replace(is.na(.), 0) %>%
replace(. == na_replace_list_temp[[1]], NA)
# ## table1_cerebrovascular_disease.
table1_cerebrovascular_disease <-
expand.grid(
era = era_set,
cerebrovascular_disease =
c("Yes",
"No",
"Missing")) %>%
dplyr::full_join(table1_cerebrovascular_disease %>% tidyr::replace_na(na_replace_list_temp)) %>%
dplyr::arrange(era) %>%
replace(is.na(.), 0) %>%
replace(. == na_replace_list_temp[[1]], NA)
# ----
#######################################################
# Save tibbles that will inform vectors for the table #
#######################################################
# ----
# write.csv(
#   x = table1_ageGroup,
#   file = here::here("output",paste0("table1_ageGroup","_",sensitivity_cohort,".csv")))
# )
# write.csv(
#   x = table1_Sex,
#   file = here::here("output",paste0("table1_Sex","_",sensitivity_cohort,".csv"))
# )
# write.csv(
#   x = table1_admission_method,
#   file = here::here("output",paste0("table1_admission_method","_",sensitivity_cohort,".csv"))
# )
# write.csv(
#   x = table1_postOp_mortality_30day,)
#   file = here::here("output",paste0("table1_postOp_mortality_30day","_",sensitivity_cohort,".csv")
# )
# write.csv(
#   x = table1_postOp_mortality_90day,
#   file = here::here("output",paste0("table1_postOp_mortality_90day","_",sensitivity_cohort,".csv"))
# )
# write.csv(
#   x = table1_postOp_mortality_6mth,
#   file = here::here("output",paste0("table1_postOp_mortality_6mth","_",sensitivity_cohort,".csv"))
# )
# write.csv(
#   x = table1_postOp_mortality_12mth,
#   file = here::here("output",paste0("table1_postOp_mortality_12mth","_",sensitivity_cohort,".csv"))
# )
# write.csv(
#   x = table1_postOp_pulmonary_complication_30day,
#   file = here::here("output",paste0("table1_postOp_pulmonary_complication_30day","_",sensitivity_cohort,".csv"))
# )
# write.csv(
#   x = table1_postOp_cardiac_complication_30day,
#   file = here::here("output",paste0("table1_postOp_cardiac_complication_30day","_",sensitivity_cohort,".csv"))
# )
# write.csv(
#   x = table1_postOp_cerebrovascular_complication_30day,
#   file = here::here("output",paste0("table1_postOp_cerebrovascular_complication_30day","_",sensitivity_cohort,".csv"))
# )
# write.csv(
#   x = table1_chronic_cardiac_disease,
#   file = here::here("output",paste0("table1_chronic_cardiac_disease","_",sensitivity_cohort,".csv"))
# )
# write.csv(
#   x = table1_diabetes,
#   file = here::here("output",paste0("table1_diabetes","_",sensitivity_cohort,".csv"))
# )
# write.csv(
#   x = table1_chronic_respiratory_disease,
#   file = here::here("output",paste0("table1_chronic_respiratory_disease","_",sensitivity_cohort,".csv"))
# )
# write.csv(
#   x = table1_cerebrovascular_disease,
#   file = here::here("output",paste0("table1_cerebrovascular_disease","_",sensitivity_cohort,".csv"))
# )
# ----
######################################
# Make vectors to inform the tables. #
######################################
# ----
# Age band.
list_ageGroup <-
fnc_countsAndPercentages(table_to_use = table1_ageGroup,
strata = "_ageGroup",
strata_col = "age_group_surgery")
# Sex.
list_Sex <-
fnc_countsAndPercentages(table_to_use = table1_Sex,
strata = "_Sex",
strata_col = "Sex")
# Admission method.
list_admission_method <-
fnc_countsAndPercentages(table_to_use = table1_admission_method,
strata = "_admission_method",
strata_col = "category_admission_method")
# 30-day post-operative mortality.
list_postOp_mortality_30day <-
fnc_countsAndPercentages(table_to_use = table1_postOp_mortality_30day,
strata = "_postOp_mortality_30day",
strata_col = "postOp_mortality_30day")
# 30-day post-operative mortality.
list_postOp_mortality_30day <-
fnc_countsAndPercentages(table_to_use = table1_postOp_mortality_30day,
strata = "_postOp_mortality_30day",
strata_col = "postOp_mortality_30day")
# 90-day post-operative mortality.
list_postOp_mortality_90day <-
fnc_countsAndPercentages(table_to_use = table1_postOp_mortality_90day,
strata = "_postOp_mortality_90day",
strata_col = "postOp_mortality_90day")
# 6-month post-operative mortality.
list_postOp_mortality_6mth <-
fnc_countsAndPercentages(table_to_use = table1_postOp_mortality_6mth,
strata = "_postOp_mortality_6mth",
strata_col = "postOp_mortality_6mth")
# 12-month post-operative mortality.
list_postOp_mortality_12mth <-
fnc_countsAndPercentages(table_to_use = table1_postOp_mortality_12mth,
strata = "_postOp_mortality_12mth",
strata_col = "postOp_mortality_12mth")
# 30-day post-operative pulmonary complication.
list_postOp_pulmonary_complication_30day <-
fnc_countsAndPercentages(table_to_use = table1_postOp_pulmonary_complication_30day,
strata = "_pulmonary_complication_30day",
strata_col = "pulmonary_complication_30day")
# 30-day post-operative cardiac complication.
list_postOp_cardiac_complication_30day <-
fnc_countsAndPercentages(table_to_use = table1_postOp_cardiac_complication_30day,
strata = "_cardiac_complication_30day",
strata_col = "cardiac_complication_30day")
# 30-day post-operative pulmonary complication.
list_postOp_cerebrovascular_complication_30day <-
fnc_countsAndPercentages(table_to_use = table1_postOp_cerebrovascular_complication_30day,
strata = "_cerebrovascular_complication_30day",
strata_col = "cerebrovascular_complication_30day")
# Chronic cardiac disease.
list_chronic_cardiac_disease <-
fnc_countsAndPercentages(table_to_use = table1_chronic_cardiac_disease,
strata = "_chronic_cardiac_disease",
strata_col = "chronic_cardiac_disease")
# Diabetes.
list_diabetes <-
fnc_countsAndPercentages(table_to_use = table1_diabetes,
strata = "_diabetes",
strata_col = "diabetes")
# Chronic respiratory disease.
list_chronic_respiratory_disease <-
fnc_countsAndPercentages(table_to_use = table1_chronic_respiratory_disease,
strata = "_chronic_respiratory_disease",
strata_col = "chronic_respiratory_disease")
# Cerebrovascular disease.
list_cerebrovascular_disease <-
fnc_countsAndPercentages(table_to_use = table1_cerebrovascular_disease,
strata = "_cerebrovascular_disease",
strata_col = "cerebrovascular_disease")
# ----
####################
# Make the tables. #
####################
# Pre-pandemic tables. ----
# ## Demographics table.
tbl_PP_demogs <-
rbind(
list_ageGroup$PP_ageGroup,
list_Sex$PP_Sex,
list_admission_method$PP_admission_method,
list_chronic_cardiac_disease$PP_chronic_cardiac_disease,
list_diabetes$PP_diabetes,
list_chronic_respiratory_disease$PP_chronic_respiratory_disease,
list_cerebrovascular_disease$PP_cerebrovascular_disease) %>%
dplyr::select(strata, n_all_intervals, pct_all_intervals) %>%
tibble::add_column(., c(
rep("Age group",5),
rep("Sex",2),
rep("Admission method",3),
rep("Chronic cardiac disease",2),
rep("Diabetes",2),
rep("Chronic respiratory disease",2),
rep("Cerebrovascular disease",2)),
.before = "strata"
) %>%
`colnames<-`(c("variable", "strata", "n", "pct"))
# ## Outcomes table.
table1Outcomes_PP <-
rbind(
list_postOp_mortality_30day$PP_postOp_mortality_30day,
list_postOp_mortality_90day$PP_postOp_mortality_90day,
list_postOp_mortality_6mth$PP_postOp_mortality_6mth,
list_postOp_mortality_12mth$PP_postOp_mortality_12mth,
list_postOp_pulmonary_complication_30day$PP_pulmonary_complication_30day %>% arrange(desc(strata)),
list_postOp_cardiac_complication_30day$PP_cardiac_complication_30day %>% arrange(desc(strata)),
list_postOp_cerebrovascular_complication_30day$PP_cerebrovascular_complication_30day %>% arrange(desc(strata))) %>%
dplyr::select(strata, n_all_intervals, pct_all_intervals) %>%
dplyr::filter(!strata %in% c("Error: Surgery after death",
"No death recorded", "No surgery recorded")) %>%
tibble::add_column(., c(
rep("30-day post-operative mortality",2),
rep("90-day post-operative mortality",2),
rep("6-month post-operative mortality",2),
rep("12-month post-operative mortality",2),
rep("30-day post-operative pulmonary complication",2),
rep("30-day post-operative cardiac complication",2),
rep("30-day post-operative cerebrovascular complication",2)),
.before = "strata"
) %>%
`colnames<-`(c("variable", "strata", "n", "pct"))
# ## Save table.
write.csv(
x = table1Outcomes_PP,
file = here::here("output",paste0("table1Outcomes_PP","_",sensitivity_cohort,".csv"))
)
# ----
# Pandemic no vaccine tables. ----
# ## Demographics table.
tbl_PNV_demogs <-
rbind(
list_ageGroup$PNV_ageGroup,
list_Sex$PNV_Sex,
list_admission_method$PNV_admission_method,
list_chronic_cardiac_disease$PNV_chronic_cardiac_disease,
list_diabetes$PNV_diabetes,
list_chronic_respiratory_disease$PNV_chronic_respiratory_disease,
list_cerebrovascular_disease$PNV_cerebrovascular_disease) %>%
tibble::add_column(., c(
rep("Age group",5),
rep("Sex",2),
rep("Admission method",3),
rep("Chronic cardiac disease",2),
rep("Diabetes",2),
rep("Chronic respiratory disease",2),
rep("Cerebrovascular disease",2)),
.before = "strata"
) %>%
`colnames<-`(c("variable", "strata", colnames(.)[3:ncol(.)]))
# ## Outcomes table.
table1Outcomes_PNV <-
rbind(
list_postOp_mortality_30day$PNV_postOp_mortality_30day,
list_postOp_mortality_90day$PNV_postOp_mortality_90day,
list_postOp_mortality_6mth$PNV_postOp_mortality_6mth,
list_postOp_mortality_12mth$PNV_postOp_mortality_12mth,
list_postOp_pulmonary_complication_30day$PNV_pulmonary_complication_30day %>% arrange(desc(strata)),
list_postOp_cardiac_complication_30day$PNV_cardiac_complication_30day %>% arrange(desc(strata)),
list_postOp_cerebrovascular_complication_30day$PNV_cerebrovascular_complication_30day %>% arrange(desc(strata))) %>%
dplyr::filter(!strata %in% c("Error: Surgery after death",
"No death recorded", "No surgery recorded")) %>%
tibble::add_column(., c(
rep("30-day post-operative mortality",2),
rep("90-day post-operative mortality",2),
rep("6-month post-operative mortality",2),
rep("12-month post-operative mortality",2),
rep("30-day post-operative pulmonary complication",2),
rep("30-day post-operative cardiac complication",2),
rep("30-day post-operative cerebrovascular complication",2)),
.before = "strata"
) %>%
`colnames<-`(c("variable", "strata", colnames(.)[3:ncol(.)]))
# Save table.
write.csv(
x = table1Outcomes_PNV,
file = here::here("output",paste0("table1Outcomes_PNV","_",sensitivity_cohort,".csv"))
)
# ----
# COVIDSurg data collection period tables. ----
# ## Demographics table.
tbl_CSP_demogs <-
rbind(
list_ageGroup$CSP_ageGroup,
list_Sex$CSP_Sex,
list_admission_method$CSP_admission_method,
list_chronic_cardiac_disease$CSP_chronic_cardiac_disease,
list_diabetes$CSP_diabetes,
list_chronic_respiratory_disease$CSP_chronic_respiratory_disease,
list_cerebrovascular_disease$CSP_cerebrovascular_disease) %>%
tibble::add_column(., c(
rep("Age group",5),
rep("Sex",2),
rep("Admission method",3),
rep("Chronic cardiac disease",2),
rep("Diabetes",2),
rep("Chronic respiratory disease",2),
rep("Cerebrovascular disease",2)),
.before = "strata"
) %>%
`colnames<-`(c("variable", "strata", colnames(.)[3:ncol(.)]))
# ## Outcomes table.
table1Outcomes_CSP <-
rbind(
list_postOp_mortality_30day$CSP_postOp_mortality_30day,
list_postOp_mortality_90day$CSP_postOp_mortality_90day,
list_postOp_mortality_6mth$CSP_postOp_mortality_6mth,
list_postOp_mortality_12mth$CSP_postOp_mortality_12mth,
list_postOp_pulmonary_complication_30day$CSP_pulmonary_complication_30day %>% arrange(desc(strata)),
list_postOp_cardiac_complication_30day$CSP_cardiac_complication_30day %>% arrange(desc(strata)),
list_postOp_cerebrovascular_complication_30day$CSP_cerebrovascular_complication_30day %>% arrange(desc(strata))) %>%
dplyr::filter(!strata %in% c("Error: Surgery after death",
"No death recorded", "No surgery recorded")) %>%
tibble::add_column(., c(
rep("30-day post-operative mortality",2),
rep("90-day post-operative mortality",2),
rep("6-month post-operative mortality",2),
rep("12-month post-operative mortality",2),
rep("30-day post-operative pulmonary complication",2),
rep("30-day post-operative cardiac complication",2),
rep("30-day post-operative cerebrovascular complication",2)),
.before = "strata"
) %>%
`colnames<-`(c("variable", "strata", colnames(.)[3:ncol(.)]))
# Save table.
write.csv(
x = table1Outcomes_CSP,
file = here::here("output",paste0("table1Outcomes_CSP","_",sensitivity_cohort,".csv"))
)
# ----
# Pandemic with vaccine tables. ----
# ## Demographics table.
tbl_PWV_demogs <-
rbind(
list_ageGroup$PWV_ageGroup,
list_Sex$PWV_Sex,
list_admission_method$PWV_admission_method,
list_chronic_cardiac_disease$PWV_chronic_cardiac_disease,
list_diabetes$PWV_diabetes,
list_chronic_respiratory_disease$PWV_chronic_respiratory_disease,
list_cerebrovascular_disease$PWV_cerebrovascular_disease) %>%
tibble::add_column(., c(
rep("Age group",5),
rep("Sex",2),
rep("Admission method",3),
rep("Chronic cardiac disease",2),
rep("Diabetes",2),
rep("Chronic respiratory disease",2),
rep("Cerebrovascular disease",2)),
.before = "strata"
) %>%
`colnames<-`(c("variable", "strata", colnames(.)[3:ncol(.)]))
# ## Outcomes table.
table1Outcomes_PWV <-
rbind(
list_postOp_mortality_30day$PWV_postOp_mortality_30day,
list_postOp_mortality_90day$PWV_postOp_mortality_90day,
list_postOp_mortality_6mth$PWV_postOp_mortality_6mth,
list_postOp_mortality_12mth$PWV_postOp_mortality_12mth,
list_postOp_pulmonary_complication_30day$PWV_pulmonary_complication_30day %>% arrange(desc(strata)),
list_postOp_cardiac_complication_30day$PWV_cardiac_complication_30day %>% arrange(desc(strata)),
list_postOp_cerebrovascular_complication_30day$PWV_cerebrovascular_complication_30day %>% arrange(desc(strata))) %>%
dplyr::filter(!strata %in% c("Error: Surgery after death",
"No death recorded", "No surgery recorded")) %>%
tibble::add_column(., c(
rep("30-day post-operative mortality",2),
rep("90-day post-operative mortality",2),
rep("6-month post-operative mortality",2),
rep("12-month post-operative mortality",2),
rep("30-day post-operative pulmonary complication",2),
rep("30-day post-operative cardiac complication",2),
rep("30-day post-operative cerebrovascular complication",2)),
.before = "strata"
) %>%
`colnames<-`(c("variable", "strata", colnames(.)[3:ncol(.)]))
# Save table.
write.csv(
x = table1Outcomes_PWV,
file = here::here("output",paste0("table1Outcomes_PWV","_",sensitivity_cohort,".csv"))
)
# ----
###########################################################################
# Remove the <Age group> variable from demographic table, for publication #
###########################################################################
# ----
# Pre-pandemic.
table1Demogs_PP <-
tbl_PP_demogs %>% dplyr::filter(variable != "Age group")
table1Demogs_PP[,3:ncol(table1Demogs_PP)] <-
table1Demogs_PP %>% dplyr::select(-c(variable, strata)) %>%
sapply(as.double)
# Pandemic no vaccine.
table1Demogs_PNV <-
tbl_PNV_demogs %>% dplyr::filter(variable != "Age group")
table1Demogs_PNV[,3:ncol(table1Demogs_PNV)] <-
table1Demogs_PNV %>% dplyr::select(-c(variable, strata)) %>%
sapply(as.double)
# COVIDSurg data collection period.
table1Demogs_CSP <-
tbl_CSP_demogs %>% dplyr::filter(variable != "Age group")
table1Demogs_CSP[,3:ncol(table1Demogs_CSP)] <-
table1Demogs_CSP %>% dplyr::select(-c(variable, strata)) %>%
sapply(as.double)
# Pandemic with vaccine.
table1Demogs_PWV <-
tbl_PWV_demogs %>% dplyr::filter(variable != "Age group")
table1Demogs_PWV[,3:ncol(table1Demogs_PWV)] <-
table1Demogs_PWV %>% dplyr::select(-c(variable, strata)) %>%
sapply(as.double)
# ----
# Make Table1 for all surgery patients.
data_to_use <- data_to_use_all
# Make Table1 for patients who do not have a cancer diagnosis
# since the start of our data collection period (17th March 2018).
data_to_use <- data_to_use_NC
# Make Table1 for patients whose cancer diagnosis was within
# 3 months of their surgery.
data_to_use <- data_to_use_C_within3m
# Make Table1 for patients whose cancer diagnosis was beyond
# 3 months of their surgery.
data_to_use <- data_to_use_C_outwith3m
# Make Table1 for patients whose cancer diagnosis was within
# 6 months of their surgery.
data_to_use <- data_to_use_C_within6m
# Make Table1 for patients whose cancer diagnosis was beyond
# 3 months of their surgery.
data_to_use <- data_to_use_C_outwith3m
myDataSelect <- myData %>%
dplyr::filter(postOp_mortality_30day %in% c("Dead within 30 days post-operation",
"Alive within 30 days post-operation",
"No death recorded"),
preOperative_infection_status!=
"Error: Test result after surgery. Check study_definition.",
era != "No surgery date recorded",
COVIDSurg_data_collection_period != "No surgery date recorded")
data_to_use_all <- myDataSelect %>% dplyr::filter(has_surgery == TRUE)
data_to_use_NC <- myDataSelect %>% dplyr::filter(has_surgery == TRUE) %>%
dplyr::filter(has_cancer == FALSE)
data_to_use_C_within3m <- myDataSelect %>% dplyr::filter(has_surgery == TRUE) %>%
dplyr::filter(has_cancer == TRUE) %>%
dplyr::filter(category_cancer_within_3mths_surgery ==
"Cancer diagnosis within 3mths before surgery" |
category_cancer_within_3mths_surgery ==
"Cancer diagnosis within 3mths after surgery")
data_to_use_C_outwith3m <- myDataSelect %>% dplyr::filter(has_surgery == TRUE) %>%
dplyr::filter(has_cancer == TRUE) %>%
dplyr::filter(category_cancer_within_3mths_surgery ==
"No cancer diagnosis within 3mths before or after surgery")
data_to_use_C_within6m <- myDataSelect %>% dplyr::filter(has_surgery == TRUE) %>%
dplyr::filter(has_cancer == TRUE) %>%
dplyr::filter(category_cancer_within_6mths_surgery ==
"Cancer diagnosis within 6mths before surgery" |
category_cancer_within_6mths_surgery ==
"Cancer diagnosis within 6mths after surgery")
source(here::here("analysis","Make_table_COVIDSurg_compare.R"))
# Make Table1 for all surgery patients.
message("\nMaking Table1 for all surgery patients...")
data_to_use <- data_to_use_all
sensitivity_cohort <- "all"
source(here::here("analysis","Make_Table1.R"))
rm(data_to_use, sensitivity_cohort)
message("n\t\t...table complete.\n\n")
message(paste0("\nMaking Table1 for patients who do not have a cancer diagnosis ",
"since the start of our data collection period (17th March 2018)..."))
data_to_use <- data_to_use_NC
sensitivity_cohort <- "NC"
source(here::here("analysis","Make_Table1.R"))
rm(data_to_use, sensitivity_cohort)
message("\n\t\t...table complete.\n\n")
message(paste0("\nMaking Table1 for patients whose cancer diagnosis was within ",
"3 months of their surgery...."))
data_to_use <- data_to_use_C_within3m
sensitivity_cohort <- "C_within3m"
source(here::here("analysis","Make_Table1.R"))
rm(data_to_use, sensitivity_cohort)
message("\n\t\t...table complete.\n\n")
message(paste0("\nMaking Table1 for patients whose cancer diagnosis was beyond ",
"3 months of their surgery...."))
data_to_use <- data_to_use_C_outwith3m
sensitivity_cohort <- "C_outwith3m"
source(here::here("analysis","Make_Table1.R"))
rm(data_to_use, sensitivity_cohort)
message("\n\t\t...table complete.\n\n")
message(paste0("\nMaking Table1 for patients whose cancer diagnosis was within ",
"6 months of their surgery...."))
data_to_use <- data_to_use_C_within6m
sensitivity_cohort <- "C_within6m"
source(here::here("analysis","Make_Table1.R"))
rm(data_to_use, sensitivity_cohort)
message("\n\t\t...table complete.\n\n")
data_to_use %>% select(era) %>% unique() %>% as.matrix()
data_to_use <- myDataSelect %>% dplyr::filter(has_surgery == TRUE)
data_to_use %>% select(era) %>% unique() %>% as.matrix()
data_to_use %>% select(era) %>% unique() %>% as.matrix() %>%
rbind("COVIDSurg data collection period") %>% rep(each = 3)
list_timing_of_cancer_diagnosis$PP_timing_of_cancer_diagnosis
list_timing_of_cancer_diagnosis$PP_timing_of_cancer_diagnosis %>%
dplyr::select(strata, n_all_intervals, pct_all_intervals)
list_timing_of_cancer_diagnosis$PP_timing_of_cancer_diagnosis %>%
dplyr::select(strata, n_all_intervals, pct_all_intervals) %>%
tibble::add_column(variable = rep("Timing of cancer diagnosis",3),
.before = "strata")
?choose
choose(3, 2)
p<-10;sum(choose(p, 1), choose(p, 2), choose(p, 3), choose(p, 4))
p<-50;sum(choose(p, 1), choose(p, 2), choose(p, 3), choose(p, 4))
