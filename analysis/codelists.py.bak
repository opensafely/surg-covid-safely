from cohortextractor import (codelist_from_csv, combine_codelists)

## #####################
## Cohort definition
## #####################

# Patients with a cancer diagnosis (SNOMED)
# (https://www.opencodelists.org/codelist/user/ciaranmci/cancer-snomed-ct/4602666f/).
codelist_cancer = codelist_from_csv(
   "codelists/user-ciaranmci-cancer-snomed-ct.csv",
   system="snomed",
   column="code",
)
# Patients with a cancer diagnosis (CTV3)
# (https://www.opencodelists.org/codelist/user/jkua/cancer/1d9bf8ff/).
codelist_cancer_ctv3 = codelist_from_csv(
   "codelists/user-jkua-cancer.csv",
   system="ctv",
   column="code",
)

# Patients undergoing surgery
# (https://www.opencodelists.org/codelist/user/ciaranmci/surgery-covidsurg-replication-excluding-exclusions/5c09dd62/).
codelist_cancer_surgery = codelist_from_csv(
    "codelists/user-ciaranmci-surgery-covidsurg-replication-excluding-exclusions.csv",
    system="snomed",
    column="code",
)

# First COVID vaccination administerd (https://www.opencodelists.org/codelist/primis-covid19-vacc-uptake/covadm1/v1/)
codelist_COVID_first_vaccination = codelist_from_csv(
    "codelists/primis-covid19-vacc-uptake-covadm1.csv",
    system="snomed",
    column="code",
)

# Second COVID vaccination administerd (https://www.opencodelists.org/codelist/primis-covid19-vacc-uptake/covadm2/v1/)
codelist_COVID_second_vaccination = codelist_from_csv(
    "codelists/primis-covid19-vacc-uptake-covadm2.csv",
    system="snomed",
    column="code",
)

# First COVID vaccination declined (https://www.opencodelists.org/codelist/primis-covid19-vacc-uptake/cov1decl/v1.1/)
codelist_COVID_first_vaccination_declined = codelist_from_csv(
    "codelists/primis-covid19-vacc-uptake-cov1decl.csv",
    system="snomed",
    column="code",
)

# Second COVID vaccination declined (https://www.opencodelists.org/codelist/primis-covid19-vacc-uptake/cov2decl/v1.1/)
codelist_COVID_second_vaccination_declined = codelist_from_csv(
    "codelists/primis-covid19-vacc-uptake-cov2decl.csv",
    system="snomed",
    column="code",
)

# Patients with a cancer diagnosis, excluding lung and haematological cancers (SNOMED)
# (https://www.opencodelists.org/codelist/opensafely/cancer-excluding-lung-and-haematological-snomed/2020-04-15/).
codelist_cancer_excluding_lung_and_haematological = codelist_from_csv(
   "codelists/opensafely-cancer-excluding-lung-and-haematological-snomed.csv",
   system="snomed",
   column="id",
)
# Patients with a cancer diagnosis, excluding lung and haematological cancers (CTV3)
# (https://www.opencodelists.org/codelist/opensafely/cancer-excluding-lung-and-haematological/2020-04-15/).
codelist_cancer_excluding_lung_and_haematological_ctv3 = codelist_from_csv(
   "codelists/opensafely-cancer-excluding-lung-and-haematological.csv",
   system="ctv",
   column="CTV3ID",
)

# Patients with a lung cancer diagnosis (SNOMED)
# (https://www.opencodelists.org/codelist/opensafely/lung-cancer-snomed/2020-04-15/).
codelist_cancer_lung = codelist_from_csv(
   "codelists/opensafely-lung-cancer-snomed.csv",
   system="snomed",
   column="id",
)
# Patients with a lung cancer diagnosis (CTV3)
# (https://www.opencodelists.org/codelist/opensafely/lung-cancer/2020-04-15/).
codelist_cancer_lung_ctv3 = codelist_from_csv(
   "codelists/opensafely-lung-cancer.csv",
   system="ctv",
   column="CTV3ID",
)

# Patients with a haematological cancer diagnosis (SNOMED)
# (https://www.opencodelists.org/codelist/opensafely/haematological-cancer-snomed/).
codelist_cancer_haematological = codelist_from_csv(
   "codelists/opensafely-haematological-cancer-snomed.csv",
   system="snomed",
   column="id",
)
# Patients with a haematological cancer diagnosis (CTV3)
# (https://www.opencodelists.org/codelist/opensafely/haematological-cancer/2020-04-15/.
codelist_cancer_haematological_ctv3 = codelist_from_csv(
   "codelists/opensafely-haematological-cancer.csv",
   system="ctv",
   column="CTV3ID",
)


# Patients with a cancer diagnosis (SNOMED) using codelist_combine().
# (https://www.opencodelists.org/codelist/user/ciaranmci/cancer-snomed-ct/4602666f/).
codelist_cancer_combine = combine_codelists(
   codelist_cancer_excluding_lung_and_haematological,
   codelist_cancer_lung,
   codelist_cancer_haematological
)
# Patients with a cancer diagnosis (CTV3) using codelist_combine().
# (https://www.opencodelists.org/codelist/user/jkua/cancer/1d9bf8ff/).
codelist_cancer_ctv3_combine = combine_codelists(
   codelist_cancer_excluding_lung_and_haematological_ctv3,
   codelist_cancer_lung_ctv3,
   codelist_cancer_haematological_ctv3
)

# #####################
# Exposure
# #####################
# No codelits needed.


# #####################
# Outcomes
# #####################
# ## Outcomes used in the original COVIDSurg study.

## Post-operative mortality.
# No codelists needed.

### 30-day post-operative pulmonary complications.
## Defined by the presence of any codes for pneumonia,
## acute respiratory distress syndrome, or unexpected
## post-operative ventilation.
#
## Pneumonia.
#codelist_pneumonia = codelist_from_csv(
#    "codelists/codelist-pneumonia.csv",
#    system="snomed",
#    column="code",
#)
## Acute respiratory distress syndrome, ARDS.
#codelist_ARDS = codelist_from_csv(
#    "codelists/codelist-ARDS.csv",
#    system="snomed",
#    column="code",
#)
## Unexpected post-operative ventilation.
#codelist_unexpected_ventilation = codelist_from_csv(
#    "codelists/codelist-unexpected-ventilation.csv",
#    system="snomed",
#    column="code",
#)
## Post-operative pulmonary complications.
#codelist_pulmonary_complications = combine_codelists(
#    codelist_pneumonia,
#    codelist_ARDS,
#    codelist_unexpected_ventilation,
#)
#
## ## Outcomes in addition to those used in the original
## ## COVIDSurg study.
#
### 30-day post-operative cardiac complications.
## Defined by...
#
### Post-operative *<indicator of post-operative cardiac complications>.
#codelist_* = codelist_from_csv(
#    "codelists/codelist-*.csv",
#    system="snomed",
#    column="code",
#)
### Post-operative **<indicator of post-operative cardiac complications>.
#codelist_** = codelist_from_csv(
#    "codelists/codelist-**.csv",
#    system="snomed",
#    column="code",
#)
### Post-operative cardiac complications.
#codelist_cardiac_complications = combine_codelists(
#    codelist_*,
#    codelist_**,
#)
#
### 30-day post-operative cerebrovascular complications.
## Defined by...
#
## Post-operative *<indicator of post-operative cerebrovascular complications>.
#codelist_* = codelist_from_csv(
#    "codelists/codelist-*.csv",
#    system="snomed",
#    column="code",
#)
### Post-operative **<indicator of post-operative cardcerebrovascular iac #complications>.
#codelist_** = codelist_from_csv(
#    "codelists/codelist-*.csv",
#    system="snomed",
#    column="code",
#)
### Post-operative cerebrovascular complications.
#codelist_cerebrovascular_complications = combine_codelists(
#    codelist_*,
#    codelist_**,
#)
#
#
## #####################
## Covariates
## #####################
## ## Outcomes used in the original COVIDSurg study.
## Revised Cardiac Risk Index
# Defined by the sum of 1/0 indications of:
# - Current surgeryis intraperitoneal or intrathoracic;
# - History of ischemic heart disease;
# - History of congestive heart failure;
# - History of cerebrovascular disease;
# - History of diabetes mellitus treated with insulin;
# - History of chronic kidney disease (creatinine > 176 Î¼mol.l-1).
#
## Intraperioneal surgery.
#codelist_intraperioneal_surgery = codelist_from_csv(
#    "codelists/codelist-intraperioneal-surgery.csv",
#    system="snomed",
#    column="code",
#)
## Intrathoracic surgery.
#codelist_intrathoracic_surgery = codelist_from_csv(
#    "codelists/codelist-intrathoracic-surgery.csv",
#    system="snomed",
#    column="code",
#)
## Intraperioneal or intrathoracic surgery.
#codelist_intraperioneal_or_intrathoracic_surgery = codelist_combine(
#    codelist_intraperioneal_surgery,
#    codelist_intrathoracic_surgery,
#)
## Ischedmic heart disease.
#codelist_ischemic_heart_disease = codelist_from_csv(
#    "codelists/codelist-ischemic-heart-disease.csv",
#    system="snomed",
#    column="code",
#)
## Congestive heart failure.
#codelist_congestive_heart_failure = codelist_from_csv(
#    "codelists/codelist-congestive-heart-failure.csv",
#    system="snomed",
#    column="code",
#)
## Cerebrovascular disease.
#codelist_cerebrovascular_disease = codelist_from_csv(
#    "codelists/codelist-cerebrovascular-disease.csv",
#    system="snomed",
#    column="code",
#)
## Diabetes mellitus treated with insulin.
#codelist_diabetes_mellitus_treated_with_insulin = codelist_from_csv(
#    "codelists/codelist-diabetes-mellitus-treated-with-insulin.csv",
#    system="snomed",
#    column="code",
#)
## Chronic kidney disease, CKD.
#codelist_chronic_kidney_disease = codelist_from_csv(
#    "codelists/codelist-chronic-kidney-disease.csv",
#    system="snomed",
#    column="code",
#)
#
### Presence of respiratory comorbidities.
## Asthma.
#codelist_asthma = codelist_from_csv(
#  "codelists/opensafely-asthma-diagnosis-snomed.csv"
#  system="snomed",
#  colum="code",
#)
## COPD.
#codelist_COPD = codelist_from_csv(
#  "codelists/opensafely-chronic-obstructive-pulmonary-disease-copd-review-#qof.csv",
#  system="snomed",
#  colum="code",
#)
## Presence of respiratory comorbidities.
#codelist_respiratory_comorbidities = combine_codelists(
#    codelist_asthma,
#    codelist_COPD,
#)
#
### BUPA grade of surgery.
## Minor codes.
#codelist_BUPA_grade_of_surgery_minor = codelist_from_csv(
#   "codelists/codelist-BUPA-grade-of-surgery-minor.csv",
#    system = "snomed",
#    column = "code",
#)
## Major codes.
#codelist_BUPA_grade_of_surgery_major = codelist_from_csv(
#   "codelists/codelist-BUPA-grade-of-surgery-major.csv",
#    system = "snomed",
#    column = "code",
#)